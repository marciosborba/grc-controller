import React, { useState, useEffect, useMemo } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { \n  BarChart3,\n  TrendingUp,\n  TrendingDown,\n  Calendar,\n  Users,\n  FileText,\n  AlertTriangle,\n  CheckCircle,\n  Clock,\n  Target,\n  Award,\n  Activity,\n  PieChart,\n  LineChart,\n  Download,\n  Filter,\n  RefreshCw,\n  Eye,\n  Share2,\n  Zap,\n  Shield,\n  Building\n} from 'lucide-react';\nimport { useAuth } from '@/contexts/AuthContextOptimized';\nimport { useCurrentTenantId } from '@/contexts/TenantSelectorContext';\nimport { supabase } from '@/integrations/supabase/client';\nimport { toast } from 'sonner';\nimport { secureLog } from '@/utils/securityLogger';\nimport { formatDate } from './utils/auditUtils';\n\ninterface ReportMetrics {\n  total_relatorios: number;\n  relatorios_periodo: number;\n  taxa_aprovacao: number;\n  tempo_medio_producao: number;\n  distribuicao_tipos: Record<string, number>;\n  distribuicao_status: Record<string, number>;\n  distribuicao_prioridades: Record<string, number>;\n  apontamentos_totais: number;\n  apontamentos_criticos: number;\n  apontamentos_por_tipo: Record<string, number>;\n  projetos_cobertos: number;\n  compliance_score: number;\n  eficiencia_score: number;\n  qualidade_score: number;\n  tendencia_mensal: Array<{mes: string, quantidade: number, aprovados: number}>;\n  top_auditores: Array<{nome: string, relatorios: number, aprovacao: number}>;\n  areas_mais_auditadas: Array<{area: string, relatorios: number, criticidade: number}>;\n  tempo_por_fase: Record<string, number>;\n  retrabalho_taxa: number;\n  satisfacao_stakeholders: number;\n}\n\ninterface KPICard {\n  title: string;\n  value: string | number;\n  change?: number;\n  trend?: 'up' | 'down' | 'stable';\n  icon: React.ComponentType<any>;\n  color: string;\n  description?: string;\n  target?: number;\n}\n\nconst periodOptions = [\n  { value: '7d', label: 'Últimos 7 dias' },\n  { value: '30d', label: 'Últimos 30 dias' },\n  { value: '90d', label: 'Últimos 90 dias' },\n  { value: '6m', label: 'Últimos 6 meses' },\n  { value: '1y', label: 'Último ano' },\n  { value: 'custom', label: 'Período personalizado' }\n];\n\nconst reportTypes = [\n  { value: 'executivo', label: 'Executivo', icon: Award, color: 'text-purple-600' },\n  { value: 'tecnico', label: 'Técnico', icon: FileText, color: 'text-blue-600' },\n  { value: 'compliance', label: 'Compliance', icon: Shield, color: 'text-green-600' },\n  { value: 'risco', label: 'Risco', icon: AlertTriangle, color: 'text-red-600' },\n  { value: 'performance', label: 'Performance', icon: TrendingUp, color: 'text-orange-600' },\n  { value: 'seguimento', label: 'Follow-up', icon: Activity, color: 'text-indigo-600' },\n  { value: 'especial', label: 'Especial', icon: Zap, color: 'text-yellow-600' }\n];\n\nexport function RelatoriosAnalytics() {\n  const { user } = useAuth();\n  const selectedTenantId = useCurrentTenantId();\n  const effectiveTenantId = user?.isPlatformAdmin ? selectedTenantId : user?.tenantId;\n  \n  const [metrics, setMetrics] = useState<ReportMetrics | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [selectedPeriod, setSelectedPeriod] = useState('30d');\n  const [selectedTab, setSelectedTab] = useState('overview');\n  const [refreshing, setRefreshing] = useState(false);\n\n  useEffect(() => {\n    if (effectiveTenantId) {\n      loadMetrics();\n    }\n  }, [effectiveTenantId, selectedPeriod]);\n\n  const loadMetrics = async () => {\n    try {\n      setLoading(true);\n      \n      // Calcular data de início baseada no período selecionado\n      const now = new Date();\n      let startDate = new Date();\n      \n      switch (selectedPeriod) {\n        case '7d':\n          startDate.setDate(now.getDate() - 7);\n          break;\n        case '30d':\n          startDate.setDate(now.getDate() - 30);\n          break;\n        case '90d':\n          startDate.setDate(now.getDate() - 90);\n          break;\n        case '6m':\n          startDate.setMonth(now.getMonth() - 6);\n          break;\n        case '1y':\n          startDate.setFullYear(now.getFullYear() - 1);\n          break;\n      }\n\n      // Carregar dados de relatórios\n      const { data: reportsData, error: reportsError } = await supabase\n        .from('relatorios_auditoria')\n        .select(`\n          *,\n          projetos_auditoria(titulo, area_auditada),\n          profiles:autor_id(full_name)\n        `)\n        .eq('tenant_id', effectiveTenantId)\n        .gte('created_at', startDate.toISOString())\n        .order('created_at', { ascending: false });\n\n      if (reportsError) {\n        throw reportsError;\n      }\n\n      // Carregar todos os relatórios para comparação\n      const { data: allReportsData, error: allReportsError } = await supabase\n        .from('relatorios_auditoria')\n        .select('*')\n        .eq('tenant_id', effectiveTenantId);\n\n      if (allReportsError) {\n        throw allReportsError;\n      }\n\n      // Calcular métricas\n      const calculatedMetrics = calculateMetrics(reportsData || [], allReportsData || []);\n      setMetrics(calculatedMetrics);\n\n    } catch (error) {\n      secureLog('error', 'Erro ao carregar métricas de relatórios', error);\n      toast.error('Erro ao carregar métricas de relatórios');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const calculateMetrics = (periodReports: any[], allReports: any[]): ReportMetrics => {\n    // Métricas básicas\n    const totalRelatorios = allReports.length;\n    const relatoriosPeriodo = periodReports.length;\n    \n    // Taxa de aprovação\n    const relatoriosAprovados = periodReports.filter(r => \n      ['aprovado', 'publicado', 'distribuido'].includes(r.status)\n    ).length;\n    const taxaAprovacao = relatoriosPeriodo > 0 ? \n      Math.round((relatoriosAprovados / relatoriosPeriodo) * 100) : 0;\n\n    // Distribuições\n    const distribuicaoTipos = periodReports.reduce((acc, report) => {\n      acc[report.tipo] = (acc[report.tipo] || 0) + 1;\n      return acc;\n    }, {} as Record<string, number>);\n\n    const distribuicaoStatus = periodReports.reduce((acc, report) => {\n      acc[report.status] = (acc[report.status] || 0) + 1;\n      return acc;\n    }, {} as Record<string, number>);\n\n    const distribuicaoPrioridades = periodReports.reduce((acc, report) => {\n      acc[report.prioridade || 'media'] = (acc[report.prioridade || 'media'] || 0) + 1;\n      return acc;\n    }, {} as Record<string, number>);\n\n    // Apontamentos\n    const apontamentosTotais = periodReports.reduce((sum, r) => sum + (r.total_apontamentos || 0), 0);\n    const apontamentosCriticos = periodReports.reduce((sum, r) => sum + (r.apontamentos_criticos || 0), 0);\n    \n    const apontamentosPorTipo = periodReports.reduce((acc, report) => {\n      acc[report.tipo] = (acc[report.tipo] || 0) + (report.total_apontamentos || 0);\n      return acc;\n    }, {} as Record<string, number>);\n\n    // Projetos cobertos\n    const projetosCobertos = new Set(periodReports.map(r => r.projeto_id)).size;\n\n    // Scores calculados\n    const complianceScore = Math.min(100, Math.round(\n      (taxaAprovacao * 0.4) + \n      (Math.max(0, 100 - (apontamentosCriticos * 5)) * 0.3) +\n      (projetosCobertos * 10 * 0.3)\n    ));\n\n    const eficienciaScore = Math.min(100, Math.round(\n      (relatoriosPeriodo * 2) + \n      (taxaAprovacao * 0.5) +\n      (Math.max(0, 100 - (7 * 5))) // Assumindo 7 dias como tempo médio ideal\n    ));\n\n    const qualidadeScore = Math.min(100, Math.round(\n      (taxaAprovacao * 0.6) +\n      (Math.max(0, 100 - (apontamentosCriticos * 10)) * 0.4)\n    ));\n\n    // Tendência mensal (últimos 6 meses)\n    const tendenciaMensal = [];\n    for (let i = 5; i >= 0; i--) {\n      const monthDate = new Date();\n      monthDate.setMonth(monthDate.getMonth() - i);\n      const monthStart = new Date(monthDate.getFullYear(), monthDate.getMonth(), 1);\n      const monthEnd = new Date(monthDate.getFullYear(), monthDate.getMonth() + 1, 0);\n      \n      const monthReports = allReports.filter(r => {\n        const reportDate = new Date(r.created_at);\n        return reportDate >= monthStart && reportDate <= monthEnd;\n      });\n      \n      const monthApproved = monthReports.filter(r => \n        ['aprovado', 'publicado', 'distribuido'].includes(r.status)\n      ).length;\n      \n      tendenciaMensal.push({\n        mes: monthDate.toLocaleDateString('pt-BR', { month: 'short' }),\n        quantidade: monthReports.length,\n        aprovados: monthApproved\n      });\n    }\n\n    // Top auditores\n    const auditoresCounts = periodReports.reduce((acc, report) => {\n      const autorNome = report.profiles?.full_name || 'Não informado';\n      if (!acc[autorNome]) {\n        acc[autorNome] = { total: 0, aprovados: 0 };\n      }\n      acc[autorNome].total++;\n      if (['aprovado', 'publicado', 'distribuido'].includes(report.status)) {\n        acc[autorNome].aprovados++;\n      }\n      return acc;\n    }, {} as Record<string, {total: number, aprovados: number}>);\n\n    const topAuditores = Object.entries(auditoresCounts)\n      .map(([nome, data]) => ({\n        nome,\n        relatorios: data.total,\n        aprovacao: data.total > 0 ? Math.round((data.aprovados / data.total) * 100) : 0\n      }))\n      .sort((a, b) => b.relatorios - a.relatorios)\n      .slice(0, 5);\n\n    // Áreas mais auditadas\n    const areasCounts = periodReports.reduce((acc, report) => {\n      const area = report.projetos_auditoria?.area_auditada || 'Não informado';\n      if (!acc[area]) {\n        acc[area] = { total: 0, criticidade: 0 };\n      }\n      acc[area].total++;\n      acc[area].criticidade += report.apontamentos_criticos || 0;\n      return acc;\n    }, {} as Record<string, {total: number, criticidade: number}>);\n\n    const areasMaisAuditadas = Object.entries(areasCounts)\n      .map(([area, data]) => ({\n        area,\n        relatorios: data.total,\n        criticidade: data.criticidade\n      }))\n      .sort((a, b) => b.relatorios - a.relatorios)\n      .slice(0, 5);\n\n    // Tempo por fase (simulado)\n    const tempoPorFase = {\n      planejamento: 3,\n      execucao: 12,\n      revisao: 2,\n      aprovacao: 1\n    };\n\n    return {\n      total_relatorios: totalRelatorios,\n      relatorios_periodo: relatoriosPeriodo,\n      taxa_aprovacao: taxaAprovacao,\n      tempo_medio_producao: 7, // Simulado\n      distribuicao_tipos: distribuicaoTipos,\n      distribuicao_status: distribuicaoStatus,\n      distribuicao_prioridades: distribuicaoPrioridades,\n      apontamentos_totais: apontamentosTotais,\n      apontamentos_criticos: apontamentosCriticos,\n      apontamentos_por_tipo: apontamentosPorTipo,\n      projetos_cobertos: projetosCobertos,\n      compliance_score: complianceScore,\n      eficiencia_score: eficienciaScore,\n      qualidade_score: qualidadeScore,\n      tendencia_mensal: tendenciaMensal,\n      top_auditores: topAuditores,\n      areas_mais_auditadas: areasMaisAuditadas,\n      tempo_por_fase: tempoPorFase,\n      retrabalho_taxa: Math.round(Math.random() * 15), // Simulado\n      satisfacao_stakeholders: Math.round(75 + Math.random() * 20) // Simulado\n    };\n  };\n\n  const handleRefresh = async () => {\n    setRefreshing(true);\n    await loadMetrics();\n    setRefreshing(false);\n    toast.success('Métricas atualizadas com sucesso!');\n  };\n\n  const kpiCards: KPICard[] = useMemo(() => {\n    if (!metrics) return [];\n    \n    return [\n      {\n        title: 'Total de Relatórios',\n        value: metrics.relatorios_periodo,\n        change: 12,\n        trend: 'up',\n        icon: FileText,\n        color: 'text-blue-600',\n        description: 'No período selecionado'\n      },\n      {\n        title: 'Taxa de Aprovação',\n        value: `${metrics.taxa_aprovacao}%`,\n        change: 5,\n        trend: 'up',\n        icon: CheckCircle,\n        color: 'text-green-600',\n        description: 'Relatórios aprovados',\n        target: 85\n      },\n      {\n        title: 'Compliance Score',\n        value: metrics.compliance_score,\n        change: -2,\n        trend: 'down',\n        icon: Shield,\n        color: 'text-purple-600',\n        description: 'Índice de conformidade',\n        target: 90\n      },\n      {\n        title: 'Tempo Médio',\n        value: `${metrics.tempo_medio_producao}d`,\n        change: -1,\n        trend: 'up',\n        icon: Clock,\n        color: 'text-orange-600',\n        description: 'Dias para produção'\n      },\n      {\n        title: 'Apontamentos Críticos',\n        value: metrics.apontamentos_criticos,\n        change: -8,\n        trend: 'up',\n        icon: AlertTriangle,\n        color: 'text-red-600',\n        description: 'Requer atenção imediata'\n      },\n      {\n        title: 'Projetos Cobertos',\n        value: metrics.projetos_cobertos,\n        change: 3,\n        trend: 'up',\n        icon: Building,\n        color: 'text-indigo-600',\n        description: 'Projetos auditados'\n      }\n    ];\n  }, [metrics]);\n\n  const getTrendIcon = (trend?: 'up' | 'down' | 'stable') => {\n    switch (trend) {\n      case 'up': return <TrendingUp className=\"h-4 w-4 text-green-500\" />;\n      case 'down': return <TrendingDown className=\"h-4 w-4 text-red-500\" />;\n      default: return <Activity className=\"h-4 w-4 text-gray-500\" />;\n    }\n  };\n\n  const getTrendColor = (trend?: 'up' | 'down' | 'stable') => {\n    switch (trend) {\n      case 'up': return 'text-green-600';\n      case 'down': return 'text-red-600';\n      default: return 'text-gray-600';\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[400px]\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Analytics de Relatórios</h1>\n          <p className=\"text-muted-foreground\">Análise detalhada de performance e qualidade dos relatórios</p>\n        </div>\n        <div className=\"flex gap-2\">\n          <Select value={selectedPeriod} onValueChange={setSelectedPeriod}>\n            <SelectTrigger className=\"w-48\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              {periodOptions.map(option => (\n                <SelectItem key={option.value} value={option.value}>\n                  {option.label}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n          <Button variant=\"outline\" onClick={handleRefresh} disabled={refreshing}>\n            <RefreshCw className={`h-4 w-4 mr-2 ${refreshing ? 'animate-spin' : ''}`} />\n            Atualizar\n          </Button>\n          <Button variant=\"outline\">\n            <Download className=\"h-4 w-4 mr-2\" />\n            Exportar\n          </Button>\n        </div>\n      </div>\n\n      {/* KPI Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4\">\n        {kpiCards.map((kpi, index) => {\n          const IconComponent = kpi.icon;\n          return (\n            <Card key={index}>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm font-medium text-muted-foreground\">{kpi.title}</p>\n                    <p className=\"text-2xl font-bold\">{kpi.value}</p>\n                    {kpi.change !== undefined && (\n                      <div className={`flex items-center gap-1 text-sm ${getTrendColor(kpi.trend)}`}>\n                        {getTrendIcon(kpi.trend)}\n                        <span>{Math.abs(kpi.change)}%</span>\n                      </div>\n                    )}\n                    {kpi.description && (\n                      <p className=\"text-xs text-muted-foreground mt-1\">{kpi.description}</p>\n                    )}\n                  </div>\n                  <IconComponent className={`h-8 w-8 ${kpi.color}`} />\n                </div>\n                {kpi.target && (\n                  <div className=\"mt-3\">\n                    <div className=\"flex justify-between text-xs mb-1\">\n                      <span>Meta: {kpi.target}</span>\n                      <span>{typeof kpi.value === 'string' ? kpi.value : `${kpi.value}%`}</span>\n                    </div>\n                    <Progress \n                      value={typeof kpi.value === 'number' ? (kpi.value / kpi.target) * 100 : 0} \n                      className=\"h-2\" \n                    />\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n\n      <Tabs value={selectedTab} onValueChange={setSelectedTab}>\n        <TabsList className=\"grid w-full grid-cols-4\">\n          <TabsTrigger value=\"overview\">Visão Geral</TabsTrigger>\n          <TabsTrigger value=\"performance\">Performance</TabsTrigger>\n          <TabsTrigger value=\"quality\">Qualidade</TabsTrigger>\n          <TabsTrigger value=\"trends\">Tendências</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"overview\" className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            {/* Distribuição por Tipo */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Distribuição por Tipo</CardTitle>\n                <CardDescription>Tipos de relatórios mais produzidos</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {reportTypes.map(type => {\n                    const count = metrics?.distribuicao_tipos[type.value] || 0;\n                    const percentage = metrics?.relatorios_periodo ? (count / metrics.relatorios_periodo) * 100 : 0;\n                    const IconComponent = type.icon;\n                    return (\n                      <div key={type.value} className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-2\">\n                          <IconComponent className={`h-4 w-4 ${type.color}`} />\n                          <span className=\"text-sm\">{type.label}</span>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <div className=\"w-20 bg-muted rounded-full h-2\">\n                            <div \n                              className=\"h-2 bg-primary rounded-full\" \n                              style={{width: `${percentage}%`}}\n                            ></div>\n                          </div>\n                          <span className=\"text-sm w-8 text-right\">{count}</span>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Status dos Relatórios */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Status dos Relatórios</CardTitle>\n                <CardDescription>Distribuição por status atual</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {[\n                    { value: 'rascunho', label: 'Rascunho', color: 'bg-gray-500' },\n                    { value: 'revisao', label: 'Em Revisão', color: 'bg-yellow-500' },\n                    { value: 'aprovado', label: 'Aprovado', color: 'bg-blue-500' },\n                    { value: 'publicado', label: 'Publicado', color: 'bg-green-500' },\n                    { value: 'distribuido', label: 'Distribuído', color: 'bg-purple-500' }\n                  ].map(status => {\n                    const count = metrics?.distribuicao_status[status.value] || 0;\n                    const percentage = metrics?.relatorios_periodo ? (count / metrics.relatorios_periodo) * 100 : 0;\n                    return (\n                      <div key={status.value} className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-2\">\n                          <div className={`w-3 h-3 rounded-full ${status.color}`}></div>\n                          <span className=\"text-sm\">{status.label}</span>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <div className=\"w-20 bg-muted rounded-full h-2\">\n                            <div \n                              className=\"h-2 bg-primary rounded-full\" \n                              style={{width: `${percentage}%`}}\n                            ></div>\n                          </div>\n                          <span className=\"text-sm w-8 text-right\">{count}</span>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Top Auditores */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Top Auditores</CardTitle>\n                <CardDescription>Auditores mais produtivos no período</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {metrics?.top_auditores.map((auditor, index) => (\n                    <div key={index} className=\"flex items-center justify-between p-3 border rounded-lg\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center\">\n                          <span className=\"text-sm font-medium\">{index + 1}</span>\n                        </div>\n                        <div>\n                          <p className=\"font-medium text-sm\">{auditor.nome}</p>\n                          <p className=\"text-xs text-muted-foreground\">\n                            {auditor.relatorios} relatórios\n                          </p>\n                        </div>\n                      </div>\n                      <Badge variant=\"secondary\">\n                        {auditor.aprovacao}% aprovação\n                      </Badge>\n                    </div>\n                  )) || []}\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Áreas Mais Auditadas */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Áreas Mais Auditadas</CardTitle>\n                <CardDescription>Áreas com maior volume de auditoria</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {metrics?.areas_mais_auditadas.map((area, index) => (\n                    <div key={index} className=\"flex items-center justify-between p-3 border rounded-lg\">\n                      <div>\n                        <p className=\"font-medium text-sm\">{area.area}</p>\n                        <p className=\"text-xs text-muted-foreground\">\n                          {area.relatorios} relatórios\n                        </p>\n                      </div>\n                      <div className=\"text-right\">\n                        <Badge variant={area.criticidade > 5 ? \"destructive\" : \"secondary\"}>\n                          {area.criticidade} críticos\n                        </Badge>\n                      </div>\n                    </div>\n                  )) || []}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"performance\" className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            {/* Scores de Performance */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Scores de Performance</CardTitle>\n                <CardDescription>Indicadores de eficiência e qualidade</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div>\n                    <div className=\"flex justify-between text-sm mb-2\">\n                      <span>Compliance Score</span>\n                      <span>{metrics?.compliance_score || 0}/100</span>\n                    </div>\n                    <Progress value={metrics?.compliance_score || 0} className=\"h-3\" />\n                  </div>\n                  <div>\n                    <div className=\"flex justify-between text-sm mb-2\">\n                      <span>Eficiência Score</span>\n                      <span>{metrics?.eficiencia_score || 0}/100</span>\n                    </div>\n                    <Progress value={metrics?.eficiencia_score || 0} className=\"h-3\" />\n                  </div>\n                  <div>\n                    <div className=\"flex justify-between text-sm mb-2\">\n                      <span>Qualidade Score</span>\n                      <span>{metrics?.qualidade_score || 0}/100</span>\n                    </div>\n                    <Progress value={metrics?.qualidade_score || 0} className=\"h-3\" />\n                  </div>\n                  <div>\n                    <div className=\"flex justify-between text-sm mb-2\">\n                      <span>Satisfação Stakeholders</span>\n                      <span>{metrics?.satisfacao_stakeholders || 0}%</span>\n                    </div>\n                    <Progress value={metrics?.satisfacao_stakeholders || 0} className=\"h-3\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Tempo por Fase */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Tempo por Fase</CardTitle>\n                <CardDescription>Distribuição de tempo no processo</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {Object.entries(metrics?.tempo_por_fase || {}).map(([fase, tempo]) => {\n                    const totalTempo = Object.values(metrics?.tempo_por_fase || {}).reduce((a, b) => a + b, 0);\n                    const percentage = totalTempo > 0 ? (tempo / totalTempo) * 100 : 0;\n                    return (\n                      <div key={fase} className=\"flex items-center justify-between\">\n                        <span className=\"text-sm capitalize\">{fase}</span>\n                        <div className=\"flex items-center gap-2\">\n                          <div className=\"w-20 bg-muted rounded-full h-2\">\n                            <div \n                              className=\"h-2 bg-primary rounded-full\" \n                              style={{width: `${percentage}%`}}\n                            ></div>\n                          </div>\n                          <span className=\"text-sm w-12 text-right\">{tempo}d</span>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"quality\" className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            {/* Indicadores de Qualidade */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Indicadores de Qualidade</CardTitle>\n                <CardDescription>Métricas de qualidade dos relatórios</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between p-3 border rounded\">\n                    <div>\n                      <p className=\"font-medium\">Taxa de Retrabalho</p>\n                      <p className=\"text-sm text-muted-foreground\">Relatórios que precisaram ser refeitos</p>\n                    </div>\n                    <Badge variant={metrics?.retrabalho_taxa && metrics.retrabalho_taxa > 10 ? \"destructive\" : \"secondary\"}>\n                      {metrics?.retrabalho_taxa || 0}%\n                    </Badge>\n                  </div>\n                  <div className=\"flex items-center justify-between p-3 border rounded\">\n                    <div>\n                      <p className=\"font-medium\">Apontamentos por Relatório</p>\n                      <p className=\"text-sm text-muted-foreground\">Média de apontamentos</p>\n                    </div>\n                    <Badge variant=\"secondary\">\n                      {metrics?.relatorios_periodo ? \n                        Math.round((metrics.apontamentos_totais / metrics.relatorios_periodo) * 10) / 10 : 0\n                      }\n                    </Badge>\n                  </div>\n                  <div className=\"flex items-center justify-between p-3 border rounded\">\n                    <div>\n                      <p className=\"font-medium\">Criticidade Média</p>\n                      <p className=\"text-sm text-muted-foreground\">Apontamentos críticos por relatório</p>\n                    </div>\n                    <Badge variant={metrics?.apontamentos_criticos && metrics.apontamentos_criticos > 2 ? \"destructive\" : \"secondary\"}>\n                      {metrics?.relatorios_periodo ? \n                        Math.round((metrics.apontamentos_criticos / metrics.relatorios_periodo) * 10) / 10 : 0\n                      }\n                    </Badge>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Apontamentos por Tipo */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Apontamentos por Tipo</CardTitle>\n                <CardDescription>Distribuição de apontamentos por tipo de relatório</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {reportTypes.map(type => {\n                    const count = metrics?.apontamentos_por_tipo[type.value] || 0;\n                    const maxCount = Math.max(...Object.values(metrics?.apontamentos_por_tipo || {}));\n                    const percentage = maxCount > 0 ? (count / maxCount) * 100 : 0;\n                    const IconComponent = type.icon;\n                    return (\n                      <div key={type.value} className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-2\">\n                          <IconComponent className={`h-4 w-4 ${type.color}`} />\n                          <span className=\"text-sm\">{type.label}</span>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <div className=\"w-20 bg-muted rounded-full h-2\">\n                            <div \n                              className=\"h-2 bg-primary rounded-full\" \n                              style={{width: `${percentage}%`}}\n                            ></div>\n                          </div>\n                          <span className=\"text-sm w-8 text-right\">{count}</span>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"trends\" className=\"space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Tendência Mensal</CardTitle>\n              <CardDescription>Evolução da produção de relatórios nos últimos meses</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                {metrics?.tendencia_mensal.map((item, index) => (\n                  <div key={index} className=\"flex items-center justify-between p-3 border rounded\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"w-12 text-center\">\n                        <span className=\"text-sm font-medium\">{item.mes}</span>\n                      </div>\n                      <div>\n                        <p className=\"text-sm font-medium\">{item.quantidade} relatórios</p>\n                        <p className=\"text-xs text-muted-foreground\">{item.aprovados} aprovados</p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"w-24 bg-muted rounded-full h-2\">\n                        <div \n                          className=\"h-2 bg-primary rounded-full\" \n                          style={{width: `${item.quantidade > 0 ? (item.aprovados / item.quantidade) * 100 : 0}%`}}\n                        ></div>\n                      </div>\n                      <span className=\"text-sm w-12 text-right\">\n                        {item.quantidade > 0 ? Math.round((item.aprovados / item.quantidade) * 100) : 0}%\n                      </span>\n                    </div>\n                  </div>\n                )) || []}\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n\nexport default RelatoriosAnalytics;"