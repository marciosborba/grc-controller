// VERSÃO CORRIGIDA COM DIFERENCIAÇÃO REAL\n\n// Substituir a função generateReportHTML por esta versão:\n\nconst generateReportHTML = (projeto: any, projetoDetalhado: any, tipo: string) => {\n  // DIFERENCIAÇÃO REAL: Verificar se é relatório técnico\n  if (tipo === 'tecnico') {\n    return generateTechnicalReportHTML(projeto, projetoDetalhado);\n  }\n  // Continuar com relatório executivo para outros tipos\n  return generateExecutiveReportHTML(projeto, projetoDetalhado, tipo);\n};\n\nconst generateTechnicalReportHTML = (projeto: any, projetoDetalhado: any) => {\n  const timestamp = new Date().toLocaleString('pt-BR');\n  const dataFormatada = new Date().toLocaleDateString('pt-BR', { \n    year: 'numeric', \n    month: 'long', \n    day: 'numeric' \n  });\n  \n  const totalApontamentos = projetoDetalhado?.apontamentos_auditoria?.length || 0;\n  const apontamentosCriticos = projetoDetalhado?.apontamentos_auditoria?.filter(a => a.criticidade === 'critica').length || 0;\n  const apontamentosAltos = projetoDetalhado?.apontamentos_auditoria?.filter(a => a.criticidade === 'alta').length || 0;\n  const totalTrabalhos = projetoDetalhado?.trabalhos_auditoria?.length || 0;\n  const trabalhosConcluidos = projetoDetalhado?.trabalhos_auditoria?.filter(t => t.status === 'concluido').length || 0;\n  const planosConcluidos = projetoDetalhado?.planos_acao?.filter(p => p.status === 'concluido').length || 0;\n  const totalHorasAuditoria = projetoDetalhado?.trabalhos_auditoria?.reduce((sum, t) => sum + (t.horas_trabalhadas || 0), 0) || 0;\n  const complianceScore = totalApontamentos > 0 ? \n    Math.max(0, 100 - (apontamentosCriticos * 25 + apontamentosAltos * 15)) : 95;\n  \n  return `\n    <!DOCTYPE html>\n    <html lang=\"pt-BR\">\n    <head>\n      <title>RELATÓRIO TÉCNICO DE AUDITORIA - ${projeto.titulo}</title>\n      <meta charset=\"UTF-8\">\n      <style>\n        body { font-family: 'Inter', sans-serif; color: #1a1a1a; background: #ffffff; font-size: 13px; margin: 0; padding: 0; }\n        .page { max-width: 210mm; margin: 0 auto; background: white; min-height: 297mm; }\n        .header-page { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); color: white; padding: 45px 35px; text-align: center; }\n        .main-title { font-size: 28px; font-weight: 700; margin-bottom: 12px; }\n        .project-title { font-size: 20px; font-weight: 500; margin-bottom: 25px; }\n        .content { padding: 35px 30px; }\n        .section { margin-bottom: 35px; }\n        .section-title { font-size: 18px; font-weight: 700; color: #0f172a; margin-bottom: 18px; border-bottom: 2px solid #e5e7eb; padding-bottom: 8px; }\n        .technical-summary { background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%); border-left: 4px solid #0f172a; padding: 25px; border-radius: 8px; margin: 20px 0; }\n        .procedure-item { background: white; border: 1px solid #e2e8f0; border-radius: 8px; margin: 15px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }\n        .procedure-header { background: #f8fafc; padding: 15px 20px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; }\n        .procedure-header h4 { color: #0f172a; font-size: 14px; font-weight: 600; margin: 0; }\n        .status-badge { padding: 4px 12px; border-radius: 16px; font-size: 10px; font-weight: 600; text-transform: uppercase; }\n        .status-concluido { background: #dcfce7; color: #166534; }\n        .status-em_andamento { background: #fef3c7; color: #92400e; }\n        .status-pendente { background: #fee2e2; color: #991b1b; }\n        .finding-item { background: white; border: 1px solid #e2e8f0; border-radius: 8px; margin: 20px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }\n        .finding-section { margin: 15px 0; padding: 15px; background: #f8fafc; border-radius: 6px; border-left: 3px solid #64748b; }\n        .finding-section h5 { color: #0f172a; font-size: 12px; font-weight: 600; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }\n        .severity-badge { padding: 4px 8px; border-radius: 12px; font-size: 9px; font-weight: 600; text-transform: uppercase; }\n        .severity-critica { background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; }\n        .severity-alta { background: #fff7ed; color: #ea580c; border: 1px solid #fed7aa; }\n        .severity-media { background: #fffbeb; color: #d97706; border: 1px solid #fde68a; }\n        .severity-baixa { background: #f0fdf4; color: #059669; border: 1px solid #bbf7d0; }\n        .footer { background: #f8fafc; border-top: 1px solid #e5e7eb; padding: 25px; text-align: center; color: #6b7280; font-size: 10px; }\n        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }\n        .info-card { background: rgba(255,255,255,0.15); padding: 15px; border-radius: 8px; }\n        .info-label { font-size: 10px; text-transform: uppercase; opacity: 0.8; margin-bottom: 6px; }\n        .info-value { font-size: 14px; font-weight: 600; }\n        @media print {\n          .page { box-shadow: none; margin: 0; }\n          body { background: white; }\n          @page { margin: 0.75in 0.5in; size: A4; }\n        }\n      </style>\n    </head>\n    <body>\n      <div class=\"page\">\n        <div class=\"header-page\">\n          <h1 class=\"main-title\">RELATÓRIO TÉCNICO DE AUDITORIA</h1>\n          <h2 class=\"project-title\">${projeto.titulo}</h2>\n          \n          <div class=\"info-grid\">\n            <div class=\"info-card\">\n              <div class=\"info-label\">Código do Projeto</div>\n              <div class=\"info-value\">${projeto.codigo}</div>\n            </div>\n            <div class=\"info-card\">\n              <div class=\"info-label\">Auditor Líder</div>\n              <div class=\"info-value\">${projeto.auditor_lider || projeto.chefe_auditoria}</div>\n            </div>\n            <div class=\"info-card\">\n              <div class=\"info-label\">Total de Horas</div>\n              <div class=\"info-value\">${totalHorasAuditoria}h</div>\n            </div>\n            <div class=\"info-card\">\n              <div class=\"info-label\">Score de Compliance</div>\n              <div class=\"info-value\">${complianceScore}%</div>\n            </div>\n            <div class=\"info-card\">\n              <div class=\"info-label\">Procedimentos</div>\n              <div class=\"info-value\">${trabalhosConcluidos}/${totalTrabalhos}</div>\n            </div>\n            <div class=\"info-card\">\n              <div class=\"info-label\">Data do Relatório</div>\n              <div class=\"info-value\">${dataFormatada}</div>\n            </div>\n          </div>\n        </div>\n        \n        <div class=\"content\">\n          <!-- SUMÁRIO EXECUTIVO TÉCNICO -->\n          <div class=\"section\">\n            <h2 class=\"section-title\">SUMÁRIO EXECUTIVO TÉCNICO</h2>\n            \n            <div class=\"technical-summary\">\n              <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;\">\n                <div style=\"background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px;\">\n                  <h4 style=\"color: #0f172a; font-size: 14px; font-weight: 600; margin-bottom: 10px; text-transform: uppercase;\">Escopo da Auditoria</h4>\n                  <p style=\"font-size: 12px; line-height: 1.5; color: #475569;\">${projeto.escopo || 'Avaliação técnica abrangente dos controles internos, processos operacionais e sistemas de informação da área auditada.'}</p>\n                </div>\n                <div style=\"background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px;\">\n                  <h4 style=\"color: #0f172a; font-size: 14px; font-weight: 600; margin-bottom: 10px; text-transform: uppercase;\">Metodologia Aplicada</h4>\n                  <p style=\"font-size: 12px; line-height: 1.5; color: #475569;\">${projeto.metodologia || 'Aplicação de técnicas de auditoria baseadas em riscos, incluindo testes substantivos e análise de controles automatizados.'}</p>\n                </div>\n                <div style=\"background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px;\">\n                  <h4 style=\"color: #0f172a; font-size: 14px; font-weight: 600; margin-bottom: 10px; text-transform: uppercase;\">Período de Execução</h4>\n                  <p style=\"font-size: 12px; line-height: 1.5; color: #475569;\"><strong>Início:</strong> ${new Date(projeto.data_inicio).toLocaleDateString('pt-BR')}<br><strong>Conclusão:</strong> ${new Date(projeto.data_fim_prevista).toLocaleDateString('pt-BR')}</p>\n                </div>\n                <div style=\"background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px;\">\n                  <h4 style=\"color: #0f172a; font-size: 14px; font-weight: 600; margin-bottom: 10px; text-transform: uppercase;\">Equipe Técnica</h4>\n                  <p style=\"font-size: 12px; line-height: 1.5; color: #475569;\"><strong>Auditor Líder:</strong> ${projeto.auditor_lider || projeto.chefe_auditoria}<br><strong>Horas Totais:</strong> ${totalHorasAuditoria}h</p>\n                </div>\n              </div>\n            </div>\n          </div>\n          \n          <!-- PROCEDIMENTOS DE AUDITORIA EXECUTADOS -->\n          <div class=\"section\">\n            <h2 class=\"section-title\">PROCEDIMENTOS DE AUDITORIA EXECUTADOS</h2>\n            \n            ${projetoDetalhado?.trabalhos_auditoria?.map((trabalho, index) => `\n              <div class=\"procedure-item\">\n                <div class=\"procedure-header\">\n                  <h4>${trabalho.titulo || 'Procedimento ' + (index + 1)}</h4>\n                  <span class=\"status-badge status-${trabalho.status || 'pendente'}\">\n                    ${trabalho.status === 'concluido' ? 'Concluído' : trabalho.status === 'em_andamento' ? 'Em Andamento' : 'Pendente'}\n                  </span>\n                </div>\n                <div style=\"padding: 20px;\">\n                  <p style=\"margin: 8px 0; font-size: 12px;\"><strong>Descrição:</strong> ${trabalho.descricao || 'Procedimento de auditoria para avaliação de controles internos e processos operacionais.'}</p>\n                  <p style=\"margin: 8px 0; font-size: 12px;\"><strong>Objetivo:</strong> ${trabalho.objetivo || 'Verificar a adequação e efetividade dos controles implementados.'}</p>\n                  <p style=\"margin: 8px 0; font-size: 12px;\"><strong>Horas Trabalhadas:</strong> ${trabalho.horas_trabalhadas || 0}h</p>\n                  <p style=\"margin: 8px 0; font-size: 12px;\"><strong>Responsável:</strong> ${trabalho.responsavel || projeto.auditor_lider || 'Equipe de Auditoria'}</p>\n                  <p style=\"margin: 8px 0; font-size: 12px;\"><strong>Técnicas Utilizadas:</strong> Testes substantivos, análise documental, entrevistas</p>\n                  <div style=\"background: #f8fafc; padding: 15px; border-radius: 6px; border-left: 3px solid #3b82f6; margin-top: 15px;\">\n                    <h5 style=\"color: #0f172a; font-size: 12px; font-weight: 600; margin-bottom: 8px;\">Resultados Obtidos:</h5>\n                    <p style=\"font-size: 11px;\">${trabalho.resultados || 'Procedimento executado conforme planejado. Evidências coletadas e documentadas adequadamente.'}</p>\n                  </div>\n                </div>\n              </div>\n            `).join('')}\n          </div>\n          \n          <!-- ACHADOS DETALHADOS (CCCE) -->\n          <div class=\"section\">\n            <h2 class=\"section-title\">ACHADOS DETALHADOS DE AUDITORIA</h2>\n            <p style=\"font-size: 12px; color: #6b7280; margin-bottom: 20px;\">Estrutura CCCE: Condição, Critério, Causa, Efeito</p>\n            \n            ${projetoDetalhado?.apontamentos_auditoria?.map((apontamento, index) => `\n              <div class=\"finding-item\">\n                <div class=\"procedure-header\">\n                  <h4>${apontamento.titulo || 'Achado ' + (index + 1)}</h4>\n                  <span class=\"severity-badge severity-${apontamento.criticidade || 'baixa'}\">\n                    ${(apontamento.criticidade || 'baixa').toUpperCase()}\n                  </span>\n                </div>\n                \n                <div style=\"padding: 20px;\">\n                  <div class=\"finding-section\">\n                    <h5>Condição Identificada</h5>\n                    <p style=\"font-size: 11px; line-height: 1.4;\">${apontamento.descricao || 'Deficiência identificada nos controles internos que pode impactar a efetividade dos processos operacionais.'}</p>\n                  </div>\n                  \n                  <div class=\"finding-section\">\n                    <h5>Critério de Avaliação</h5>\n                    <p style=\"font-size: 11px; line-height: 1.4;\">Políticas e procedimentos internos, melhores práticas de mercado, requisitos regulatórios aplicáveis (SOX, COSO, ISO 27001) e padrões de auditoria interna.</p>\n                  </div>\n                  \n                  <div class=\"finding-section\">\n                    <h5>Causa Raiz</h5>\n                    <p style=\"font-size: 11px; line-height: 1.4;\">${apontamento.causa_raiz || 'Ausência de controles adequados, falhas na execução de procedimentos ou deficiências no desenho dos processos.'}</p>\n                  </div>\n                  \n                  <div class=\"finding-section\">\n                    <h5>Efeito/Impacto</h5>\n                    <p style=\"font-size: 11px; line-height: 1.4;\">${apontamento.impacto || 'Risco de falhas operacionais, exposição a perdas financeiras e não conformidade com requisitos regulatórios.'}</p>\n                    ${apontamento.valor_impacto ? '<p style=\"margin-top: 8px; font-size: 11px;\"><strong>Impacto Financeiro:</strong> R$ ' + apontamento.valor_impacto.toLocaleString('pt-BR') + '</p>' : ''}\n                  </div>\n                  \n                  <div class=\"finding-section\">\n                    <h5>Recomendação Técnica</h5>\n                    <p style=\"font-size: 11px; line-height: 1.4;\">${apontamento.recomendacao || 'Implementar controles compensatórios, revisar procedimentos operacionais e estabelecer monitoramento contínuo das atividades críticas.'}</p>\n                  </div>\n                </div>\n              </div>\n            `).join('')}\n          </div>\n          \n          <!-- CONCLUSÕES TÉCNICAS -->\n          <div class=\"section\">\n            <h2 class=\"section-title\">CONCLUSÕES TÉCNICAS</h2>\n            \n            <div class=\"technical-summary\">\n              <h3 style=\"color: #0f172a; font-size: 16px; font-weight: 600; margin-bottom: 15px;\">Avaliação Geral do Ambiente de Controles</h3>\n              <p style=\"font-size: 12px; margin-bottom: 15px;\">Com base nos procedimentos executados e análises realizadas:</p>\n              \n              <div style=\"margin: 20px 0;\">\n                <div style=\"display: flex; align-items: flex-start; gap: 12px; margin: 15px 0;\">\n                  <span style=\"width: 12px; height: 12px; border-radius: 50%; margin-top: 4px; background: ${complianceScore >= 80 ? '#059669' : '#d97706'};\"></span>\n                  <p style=\"font-size: 12px; margin: 0;\"><strong>Ambiente de Controle:</strong> ${complianceScore >= 80 ? 'Adequadamente estruturado com políticas bem definidas.' : 'Necessita melhorias na estrutura de governança.'}</p>\n                </div>\n                \n                <div style=\"display: flex; align-items: flex-start; gap: 12px; margin: 15px 0;\">\n                  <span style=\"width: 12px; height: 12px; border-radius: 50%; margin-top: 4px; background: ${apontamentosCriticos === 0 ? '#059669' : '#dc2626'};\"></span>\n                  <p style=\"font-size: 12px; margin: 0;\"><strong>Gestão de Riscos:</strong> ${apontamentosCriticos === 0 ? 'Riscos adequadamente identificados e mitigados.' : 'Riscos críticos identificados, requerendo ação imediata.'}</p>\n                </div>\n                \n                <div style=\"display: flex; align-items: flex-start; gap: 12px; margin: 15px 0;\">\n                  <span style=\"width: 12px; height: 12px; border-radius: 50%; margin-top: 4px; background: ${trabalhosConcluidos === totalTrabalhos ? '#059669' : '#d97706'};\"></span>\n                  <p style=\"font-size: 12px; margin: 0;\"><strong>Execução de Controles:</strong> ${trabalhosConcluidos === totalTrabalhos ? 'Controles operando conforme expectativas.' : 'Alguns controles necessitam ajustes.'}</p>\n                </div>\n              </div>\n              \n              <h3 style=\"color: #0f172a; font-size: 16px; font-weight: 600; margin: 25px 0 15px 0;\">Opinião Técnica</h3>\n              <div style=\"padding: 20px; border-radius: 8px; border-left: 4px solid ${complianceScore >= 80 ? '#059669' : '#d97706'}; background: ${complianceScore >= 80 ? '#f0fdf4' : '#fffbeb'}; color: ${complianceScore >= 80 ? '#166534' : '#92400e'};\">\n                <p style=\"font-size: 12px; margin: 8px 0;\"><strong>${complianceScore >= 80 ? 'OPINIÃO POSITIVA' : 'OPINIÃO COM RESSALVAS'}:</strong></p>\n                <p style=\"font-size: 12px; margin: 8px 0;\">${complianceScore >= 80 ? \n                  'Os controles internos avaliados são adequados e efetivos para mitigar os riscos identificados. O ambiente demonstra maturidade e aderência às melhores práticas.' :\n                  'Os controles apresentam adequação parcial, com deficiências que necessitam correção. As melhorias recomendadas devem ser implementadas para fortalecer o ambiente de controle.'\n                }</p>\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        <div class=\"footer\">\n          <p style=\"font-size: 11px;\"><strong>Sistema GRC - Governance, Risk & Compliance</strong></p>\n          <p style=\"font-size: 10px;\">Relatório técnico gerado automaticamente em ${timestamp}</p>\n          <p style=\"font-size: 9px; margin-top: 8px;\">Este documento contém análises técnicas detalhadas para gestores operacionais e equipes técnicas.</p>\n        </div>\n      </div>\n    </body>\n    </html>\n  `;\n};\n\nconst generateExecutiveReportHTML = (projeto: any, projetoDetalhado: any, tipo: string) => {\n  // CÓDIGO DO RELATÓRIO EXECUTIVO ORIGINAL AQUI\n  // (manter o código existente para relatório executivo)\n};