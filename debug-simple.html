<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé® Debug Simples - Cores GRC</title>
    
    <!-- Debug Sistema Simplificado (sem intercepta√ß√£o de console) -->
    <script>
      window.colorDebugLog = [];
      window.debugStartTime = performance.now();
      
      function debugLog(source, details) {
        const timestamp = performance.now() - window.debugStartTime;
        const logEntry = {
          timestamp: Math.round(timestamp),
          source,
          details,
          domReady: document.readyState
        };
        
        window.colorDebugLog.push(logEntry);
        console.log(`üé® [${Math.round(timestamp)}ms] ${source}:`, details);
      }
      
      function getCurrentColors() {
        const style = getComputedStyle(document.documentElement);
        return {
          primary: style.getPropertyValue('--primary').trim(),
          background: style.getPropertyValue('--background').trim(),
          foreground: style.getPropertyValue('--foreground').trim()
        };
      }
      
      debugLog('üöÄ INIT', { message: 'Debug simples iniciado' });
    </script>
    
    <!-- Tema Din√¢mico com Debug -->
    <script>
      debugLog('üìã PRE-SCRIPT', { message: 'Script de tema din√¢mico' });
      
      (function() {
        try {
          const savedTheme = localStorage.getItem('grc-theme-preferences');
          debugLog('üîç STORAGE-CHECK', { 
            found: !!savedTheme,
            value: savedTheme ? 'exists' : 'empty'
          });
          
          let themeColors = {
            primary: '233 79% 47%', // Default blue
            primaryForeground: '210 40% 98%',
            background: '0 0% 100%',
            foreground: '225 71% 12%',
            border: '214 32% 91%',
            muted: '210 20% 96%'
          };
          
          debugLog('üéØ DEFAULT-COLORS', { defaultPrimary: themeColors.primary });
          
          if (savedTheme) {
            try {
              const parsed = JSON.parse(savedTheme);
              debugLog('üìñ PARSE-SUCCESS', { theme: parsed });
              
              if (parsed.colorPalette && parsed.colorPalette.primary) {
                const hexToHSL = (hex) => {
                  let r = 0, g = 0, b = 0;
                  if (hex.length === 4) {
                    r = parseInt(hex[1] + hex[1], 16);
                    g = parseInt(hex[2] + hex[2], 16);
                    b = parseInt(hex[3] + hex[3], 16);
                  } else if (hex.length === 7) {
                    r = parseInt(hex.substring(1, 3), 16);
                    g = parseInt(hex.substring(3, 5), 16);
                    b = parseInt(hex.substring(5, 7), 16);
                  }
                  r /= 255; g /= 255; b /= 255;
                  const max = Math.max(r, g, b), min = Math.min(r, g, b);
                  let h = 0, s = 0;
                  const l = (max + min) / 2;
                  if (max !== min) {
                    const d = max - min;
                    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                    switch (max) {
                      case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                      case g: h = (b - r) / d + 2; break;
                      case b: h = (r - g) / d + 4; break;
                    }
                    h /= 6;
                  }
                  return Math.round(h * 360) + ' ' + Math.round(s * 100) + '% ' + Math.round(l * 100) + '%';
                };
                
                const oldPrimary = themeColors.primary;
                themeColors.primary = hexToHSL(parsed.colorPalette.primary);
                
                debugLog('üîÑ COLOR-CONVERT', {
                  hex: parsed.colorPalette.primary,
                  oldHSL: oldPrimary,
                  newHSL: themeColors.primary
                });
              }
            } catch (e) {
              debugLog('‚ùå PARSE-ERROR', { error: e.message });
            }
          }
          
          const style = document.createElement('style');
          style.textContent = `
            :root {
              --primary: ${themeColors.primary} !important;
              --primary-foreground: ${themeColors.primaryForeground} !important;
              --background: ${themeColors.background} !important;
              --foreground: ${themeColors.foreground} !important;
              --border: ${themeColors.border} !important;
              --muted: ${themeColors.muted} !important;
            }
            
            body {
              font-family: 'Inter', sans-serif;
              background-color: hsl(var(--background));
              color: hsl(var(--foreground));
              margin: 0;
              padding: 20px;
            }
          `;
          
          document.head.appendChild(style);
          
          debugLog('‚úÖ STYLE-APPLIED', {
            primaryApplied: themeColors.primary,
            cssLength: style.textContent.length
          });
          
          // Verifica√ß√£o imediata
          setTimeout(() => {
            const colors = getCurrentColors();
            debugLog('‚ö° IMMEDIATE-CHECK', {
              appliedColors: colors,
              expectedPrimary: themeColors.primary,
              match: colors.primary === themeColors.primary
            });
          }, 10);
          
        } catch (error) {
          debugLog('üí• SCRIPT-ERROR', { error: error.message });
        }
      })();
    </script>
</head>

<body>
    <script>
      debugLog('üèóÔ∏è BODY-START', { message: 'Body carregado' });
    </script>
    
    <div style="max-width: 800px; margin: 0 auto; padding: 20px;">
        <h1 style="color: hsl(var(--primary));">üé® Debug Simples - GRC Controller</h1>
        
        <div style="background: hsl(var(--muted)); padding: 20px; border-radius: 8px; margin: 20px 0;">
            <h2>üîç An√°lise de Cores</h2>
            <p>Esta p√°gina mostra como as cores s√£o carregadas.</p>
            <div style="display: flex; gap: 20px; margin: 20px 0;">
                <div style="width: 50px; height: 50px; background: hsl(var(--primary)); border-radius: 4px; border: 2px solid #333;"></div>
                <div>
                    <strong>Cor Prim√°ria</strong><br>
                    <span id="primary-value">Carregando...</span>
                </div>
            </div>
        </div>
        
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #e9ecef;">
            <h3>üìä Debug Log</h3>
            <div id="debug-display" style="font-family: monospace; font-size: 12px; max-height: 400px; overflow-y: auto;">
                Carregando logs...
            </div>
            <button onclick="updateDisplay()" style="margin-top: 10px; padding: 8px 16px; background: hsl(var(--primary)); color: white; border: none; border-radius: 4px;">Atualizar</button>
            <button onclick="exportLogs()" style="margin-top: 10px; padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px;">Exportar</button>
        </div>
        
        <div style="background: #fff3cd; padding: 20px; border-radius: 8px; margin: 20px 0; border: 1px solid #ffeaa7;">
            <h3>üß™ Teste R√°pido</h3>
            <p>Configure uma cor de teste:</p>
            <button onclick="setColor('#22c55e', 'Verde')" style="background: #22c55e; color: white; border: none; padding: 10px 20px; margin: 5px; border-radius: 4px;">Verde</button>
            <button onclick="setColor('#8b5cf6', 'Roxo')" style="background: #8b5cf6; color: white; border: none; padding: 10px 20px; margin: 5px; border-radius: 4px;">Roxo</button>
            <button onclick="setColor('#f59e0b', 'Amarelo')" style="background: #f59e0b; color: white; border: none; padding: 10px 20px; margin: 5px; border-radius: 4px;">Amarelo</button>
            <button onclick="clearStorage()" style="background: #dc3545; color: white; border: none; padding: 10px 20px; margin: 5px; border-radius: 4px;">Limpar</button>
        </div>
    </div>
    
    <script>
      debugLog('üèóÔ∏è BODY-END', { message: 'Body setup completo' });
      
      function updateDisplay() {
        const debugDiv = document.getElementById('debug-display');
        const primarySpan = document.getElementById('primary-value');
        
        const colors = getCurrentColors();
        primarySpan.textContent = colors.primary || 'N√£o encontrado';
        
        debugDiv.innerHTML = window.colorDebugLog.map(log => 
          `<div style="margin: 5px 0; padding: 5px; background: white; border-radius: 3px;">
            <strong>[${log.timestamp}ms]</strong> ${log.source}: ${JSON.stringify(log.details).substring(0, 100)}...
          </div>`
        ).join('');
      }
      
      function exportLogs() {
        const blob = new Blob([JSON.stringify(window.colorDebugLog, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `debug-simple-${Date.now()}.json`;
        a.click();
        URL.revokeObjectURL(url);
      }
      
      function setColor(color, name) {
        const preferences = {
          theme: 'light',
          language: 'pt-BR',
          colorPalette: {
            primary: color,
            secondary: '#7e22ce',
            tertiary: '#be185d'
          }
        };
        
        localStorage.setItem('grc-theme-preferences', JSON.stringify(preferences));
        alert(`Cor ${name} (${color}) configurada! Recarregue a p√°gina para ver o efeito.`);
      }
      
      function clearStorage() {
        localStorage.removeItem('grc-theme-preferences');
        alert('Storage limpo! Recarregue a p√°gina.');
      }
      
      // Atualizar display automaticamente
      setTimeout(updateDisplay, 100);
      setInterval(updateDisplay, 2000);
      
      // Log final
      debugLog('üéØ SETUP-COMPLETE', { 
        totalLogs: window.colorDebugLog.length,
        currentColors: getCurrentColors()
      });
    </script>
</body>
</html>