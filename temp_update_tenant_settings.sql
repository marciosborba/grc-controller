-- Função para atualizar settings de tenant\nCREATE OR REPLACE FUNCTION update_tenant_settings(\n    tenant_id_param UUID,\n    new_settings JSONB\n)\nRETURNS JSONB\nLANGUAGE plpgsql\nSECURITY DEFINER\nSET search_path = 'public'\nAS $$\nDECLARE\n    result JSONB;\n    current_user_id UUID;\nBEGIN\n    current_user_id := auth.uid();\n    \n    -- Verificar se usuário é admin da plataforma\n    IF NOT is_platform_admin(current_user_id) THEN\n        RAISE EXCEPTION 'Acesso negado. Apenas administradores da plataforma podem atualizar settings.';\n    END IF;\n    \n    -- Atualizar settings\n    UPDATE tenants \n    SET \n        settings = new_settings,\n        updated_at = now()\n    WHERE id = tenant_id_param\n    RETURNING jsonb_build_object(\n        'id', id, \n        'status', 'updated',\n        'settings', settings\n    ) INTO result;\n    \n    IF result IS NULL THEN\n        RAISE EXCEPTION 'Tenant não encontrado: %', tenant_id_param;\n    END IF;\n    \n    RETURN result;\nEND;\n$$;\n\n-- Comentário\nCOMMENT ON FUNCTION update_tenant_settings IS 'Função específica para atualizar settings de tenant';"