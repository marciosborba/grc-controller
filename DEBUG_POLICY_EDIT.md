# ğŸ” DEBUG DETALHADO - Erro de EdiÃ§Ã£o de PolÃ­ticas\n\n## ğŸ“‹ **InstruÃ§Ãµes para Debug**\n\nO sistema agora possui logs extremamente detalhados para identificar exatamente onde estÃ¡ ocorrendo o erro.\n\n---\n\n## ğŸ§ª **Como Testar e Capturar Logs**\n\n### **1. PreparaÃ§Ã£o:**\n1. **Abra**: Console do navegador (F12 â†’ Console)\n2. **Limpe**: Console (Ctrl+L ou botÃ£o limpar)\n3. **Acesse**: `http://localhost:8080/policy-management`\n4. **VÃ¡ para**: Aba \"ElaboraÃ§Ã£o\"\n\n### **2. Teste de EdiÃ§Ã£o:**\n1. **Clique**: Em uma polÃ­tica para expandir\n2. **Clique**: BotÃ£o \"Editar\"\n3. **Modifique**: Qualquer campo (tÃ­tulo, categoria, etc.)\n4. **Clique**: \"Salvar AlteraÃ§Ãµes\"\n5. **Observe**: Logs detalhados no console\n\n### **3. Captura de Logs:**\n1. **Copie**: Todos os logs que comeÃ§am com \"=== ğŸ” DEBUG DETALHADO\"\n2. **Cole**: Em um arquivo de texto\n3. **Envie**: Para anÃ¡lise\n\n---\n\n## ğŸ“Š **Logs Implementados**\n\n### **SeÃ§Ã£o 1: ValidaÃ§Ãµes Iniciais**\n```\n=== ğŸ” DEBUG DETALHADO - INÃCIO DO SALVAMENTO ===\nâ° Timestamp: [data/hora]\nğŸ‘¤ UsuÃ¡rio: [dados do usuÃ¡rio]\nğŸ“ editingPolicy: [polÃ­tica sendo editada]\nğŸ“‹ editFormData: [dados do formulÃ¡rio]\nğŸ“ attachedDocuments: [documentos anexados]\nğŸ”„ isLoading atual: [estado de loading]\n```\n\n### **SeÃ§Ã£o 2: ValidaÃ§Ã£o de Campos**\n```\nâœ… VALIDAÃ‡ÃƒO 1: editingPolicy existe\nğŸ” Validando tÃ­tulo...\nğŸ“ TÃ­tulo atual: \"[tÃ­tulo]\"\nğŸ“ Comprimento do tÃ­tulo: [nÃºmero]\nğŸ§¹ TÃ­tulo apÃ³s trim: \"[tÃ­tulo limpo]\"\nâœ… VALIDAÃ‡ÃƒO 2: TÃ­tulo vÃ¡lido\n\nğŸ” Validando categoria...\nğŸ“‚ Categoria atual: \"[categoria]\"\nğŸ“‚ Tipo da categoria: [tipo]\nğŸ“‹ Categorias disponÃ­veis: [array]\nğŸ” Categoria estÃ¡ na lista? [true/false]\nâœ… VALIDAÃ‡ÃƒO 3: Categoria vÃ¡lida\n```\n\n### **SeÃ§Ã£o 3: PreparaÃ§Ã£o dos Dados**\n```\nğŸ—ï¸ Construindo objeto updatedPolicy...\nğŸ“¦ updatedPolicy construÃ­do:\n  - ID: [id]\n  - TÃ­tulo: [tÃ­tulo]\n  - Categoria: [categoria]\n  - Tipo: [tipo]\n  - Prioridade: [prioridade]\n  - Data efetiva: [data]\n  - Data revisÃ£o: [data]\n  - Data expiraÃ§Ã£o: [data]\n  - URL documento: [url]\n  - Metadados: [metadados]\n  - Updated by: [usuÃ¡rio]\n```\n\n### **SeÃ§Ã£o 4: Salvamento no Banco**\n```\n=== ğŸ’¾ INÃCIO DO SALVAMENTO NO BANCO ===\nğŸ“¥ updatedPolicy recebido: [dados]\nğŸ—ï¸ Construindo updateData...\nğŸ“Š updateData construÃ­do:\n  - title: string â†’ [valor]\n  - description: string â†’ [valor]\n  - category: string â†’ [valor]\n  - document_type: string â†’ [valor]\n  - effective_date: string â†’ [valor]\n  - review_date: string â†’ [valor]\n  - expiration_date: string â†’ [valor]\n  - priority: string â†’ [valor]\n  - document_url: string â†’ [valor]\n  - metadata: object â†’ [valor]\n  - updated_at: string â†’ [valor]\n  - updated_by: string â†’ [valor]\n\nğŸ†” ID da polÃ­tica para update: [id]\nğŸ” Tipo do ID: [tipo]\nğŸš€ Executando query no Supabase...\nğŸ“¡ Tabela: policies\nğŸ”§ OperaÃ§Ã£o: UPDATE\nğŸ¯ CondiÃ§Ã£o: id = [id]\nâ±ï¸ Query executada em [tempo]ms\n```\n\n### **SeÃ§Ã£o 5: Resposta do Banco**\n```\nğŸ“¡ Resposta completa do Supabase:\n  - error: [erro ou null]\n  - data: [dados retornados]\n  - data length: [quantidade]\n\nâœ… Update realizado com sucesso!\nğŸ“„ Linhas afetadas: [nÃºmero]\nğŸ“„ Dados atualizados: [dados]\n```\n\n### **SeÃ§Ã£o 6: Tratamento de Erros**\n```\n=== âŒ ERRO DO SUPABASE DETECTADO ===\nğŸš¨ Erro completo: [erro]\nğŸš¨ CÃ³digo do erro: [cÃ³digo]\nğŸš¨ Mensagem: [mensagem]\nğŸš¨ Detalhes: [detalhes]\nğŸš¨ Hint: [dica]\n\nğŸ” ERRO DE CONSTRAINT DETECTADO!\nğŸ” Verificando valores que podem estar causando o erro...\nâŒ Categoria invÃ¡lida: [categoria]\nâœ… Categorias vÃ¡lidas: [array]\nâŒ Tipo de documento invÃ¡lido: [tipo]\nâœ… Tipos vÃ¡lidos: [array]\n```\n\n---\n\n## ğŸ¯ **Pontos de VerificaÃ§Ã£o**\n\n### **1. ValidaÃ§Ãµes de Entrada:**\n- âœ… `editingPolicy` existe?\n- âœ… TÃ­tulo nÃ£o estÃ¡ vazio?\n- âœ… Categoria foi selecionada?\n- âœ… Categoria estÃ¡ na lista vÃ¡lida?\n- âœ… Tipo de documento estÃ¡ na lista vÃ¡lida?\n\n### **2. PreparaÃ§Ã£o dos Dados:**\n- âœ… `updatedPolicy` foi construÃ­do corretamente?\n- âœ… Todos os campos necessÃ¡rios estÃ£o presentes?\n- âœ… Tipos de dados estÃ£o corretos?\n- âœ… ID da polÃ­tica estÃ¡ presente?\n\n### **3. ExecuÃ§Ã£o da Query:**\n- âœ… `updateData` foi construÃ­do corretamente?\n- âœ… Query foi executada?\n- âœ… Tempo de execuÃ§Ã£o foi razoÃ¡vel?\n- âœ… Resposta foi recebida?\n\n### **4. AnÃ¡lise da Resposta:**\n- âœ… Erro foi retornado?\n- âœ… Dados foram retornados?\n- âœ… NÃºmero de linhas afetadas?\n- âœ… Tipo de erro (se houver)?\n\n---\n\n## ğŸš¨ **PossÃ­veis Causas de Erro**\n\n### **1. Erro de Constraint (CÃ³digo 23514):**\n- **Categoria invÃ¡lida**: NÃ£o estÃ¡ na lista de categorias permitidas\n- **Tipo de documento invÃ¡lido**: NÃ£o estÃ¡ na lista de tipos permitidos\n- **Status invÃ¡lido**: Valor nÃ£o permitido para status\n\n### **2. Erro de PermissÃ£o:**\n- **RLS (Row Level Security)**: UsuÃ¡rio nÃ£o tem permissÃ£o para editar\n- **Tenant**: PolÃ­tica nÃ£o pertence ao tenant do usuÃ¡rio\n\n### **3. Erro de Dados:**\n- **ID invÃ¡lido**: PolÃ­tica nÃ£o existe\n- **Campos obrigatÃ³rios**: Campos NOT NULL estÃ£o vazios\n- **Tipos de dados**: Incompatibilidade de tipos\n\n### **4. Erro de ConexÃ£o:**\n- **Timeout**: Query demorou muito para executar\n- **Rede**: Problema de conectividade\n- **Supabase**: ServiÃ§o indisponÃ­vel\n\n---\n\n## ğŸ“ **Exemplo de Log Completo**\n\n```\n=== ğŸ” DEBUG DETALHADO - INÃCIO DO SALVAMENTO ===\nâ° Timestamp: 2025-08-23T14:30:00.000Z\nğŸ‘¤ UsuÃ¡rio: { id: \"123\", email: \"user@example.com\" }\nğŸ“ editingPolicy: { id: \"policy-123\", title: \"PolÃ­tica Original\" }\nğŸ“‹ editFormData: { title: \"PolÃ­tica Editada\", category: \"Compliance\" }\nğŸ“ attachedDocuments: []\nğŸ”„ isLoading atual: false\n\nâœ… VALIDAÃ‡ÃƒO 1: editingPolicy existe\nğŸ” Validando tÃ­tulo...\nğŸ“ TÃ­tulo atual: \"PolÃ­tica Editada\"\nğŸ“ Comprimento do tÃ­tulo: 16\nğŸ§¹ TÃ­tulo apÃ³s trim: \"PolÃ­tica Editada\"\nâœ… VALIDAÃ‡ÃƒO 2: TÃ­tulo vÃ¡lido\n\nğŸ” Validando categoria...\nğŸ“‚ Categoria atual: \"Compliance\"\nğŸ“‚ Tipo da categoria: string\nğŸ“‹ Categorias disponÃ­veis: [\"Compliance\", \"SeguranÃ§a\", ...]\nğŸ” Categoria estÃ¡ na lista? true\nâœ… VALIDAÃ‡ÃƒO 3: Categoria vÃ¡lida\n\nâœ… TODAS AS VALIDAÃ‡Ã•ES PASSARAM - Iniciando salvamento...\nğŸ”„ Definindo isLoading = true\nğŸ—ï¸ Construindo objeto updatedPolicy...\nğŸ“¦ updatedPolicy construÃ­do:\n  - ID: policy-123\n  - TÃ­tulo: PolÃ­tica Editada\n  - Categoria: Compliance\n  ...\n\nğŸš€ Chamando handleSavePolicy...\n\n=== ğŸ’¾ INÃCIO DO SALVAMENTO NO BANCO ===\nğŸ“¥ updatedPolicy recebido: { id: \"policy-123\", ... }\nğŸ—ï¸ Construindo updateData...\nğŸ“Š updateData construÃ­do:\n  - title: string â†’ PolÃ­tica Editada\n  - category: string â†’ Compliance\n  ...\n\nğŸš€ Executando query no Supabase...\nâ±ï¸ Query executada em 150ms\nğŸ“¡ Resposta completa do Supabase:\n  - error: null\n  - data: [{ id: \"policy-123\", title: \"PolÃ­tica Editada\" }]\n  - data length: 1\n\nâœ… Update realizado com sucesso!\nğŸ“„ Linhas afetadas: 1\nğŸ”„ Chamando onPolicyUpdate()...\nğŸ‰ Exibindo toast de sucesso...\nâœ… handleSavePolicy concluÃ­do com sucesso\nâœ… handleSavePolicy retornou com sucesso\nğŸ”„ Fechando modal e limpando estado...\nğŸ‰ SALVAMENTO CONCLUÃDO COM SUCESSO!\nğŸ”„ Definindo isLoading = false\n=== ğŸ FIM DO DEBUG DETALHADO ===\n```\n\n---\n\n## ğŸ¯ **PrÃ³ximos Passos**\n\n1. **Execute** o teste de ediÃ§Ã£o\n2. **Copie** todos os logs do console\n3. **Identifique** onde o processo para ou falha\n4. **Analise** os valores dos campos\n5. **Verifique** se hÃ¡ erros de constraint\n6. **Envie** os logs para anÃ¡lise detalhada\n\n---\n\n*Debug implementado em: 23 de Agosto de 2025*  \n*Objetivo: Identificar causa raiz do erro de ediÃ§Ã£o*  \n*Status: ğŸ” AGUARDANDO LOGS DE TESTE*