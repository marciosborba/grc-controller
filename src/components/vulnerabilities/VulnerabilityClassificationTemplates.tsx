import React, { useState, useEffect } from 'react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Textarea } from '@/components/ui/textarea';
import { Switch } from '@/components/ui/switch';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';
import { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Checkbox } from '@/components/ui/checkbox';
import { supabase } from '@/integrations/supabase/client';
import { useAuth } from '@/contexts/AuthContextOptimized';
import { useCurrentTenantId } from '@/contexts/TenantSelectorContext';
import { 
  Settings, 
  Plus, 
  Edit, 
  Trash2, 
  Play, 
  Pause,
  Eye,
  Copy,
  RotateCcw,
  AlertTriangle,
  CheckCircle,
  Info,
  Zap,
  Target,
  Filter,
  ArrowRight,
  ArrowDown,
  ArrowUp,
  Shield,
  Clock,
  Users,
  Tag,
  Calendar,
  TrendingUp,
  BarChart3,
  Server,
  Globe,
  Database,
  Smartphone,
  Cloud,
  Wifi,
  HardDrive,
  Lock,
  FileText,
  Activity
} from 'lucide-react';
import { toast } from 'sonner';
import { VulnerabilitySeverity, VulnerabilityStatus, VulnerabilitySource, AssetType } from './types/vulnerability';
import {
  ClassificationTemplate,
  ClassificationMetrics,
  VulnerabilityClass,
  CriticalityCriteria,
  AssetCriteria,
  ApplicationCriteria,
  CVSSVersion,
  CriticalitySource,
  AssetStatus,
  AssetExposure,
  SecurityControl,
  BusinessCriticality,
  ComplianceFramework,
  DataClassification,
  VULNERABILITY_CLASS_LABELS,
  CVSS_VERSION_LABELS,
  CRITICALITY_SOURCE_LABELS,
  ASSET_STATUS_LABELS,
  ASSET_EXPOSURE_LABELS,
  SECURITY_CONTROL_LABELS,
  BUSINESS_CRITICALITY_LABELS,
  COMPLIANCE_FRAMEWORK_LABELS,
  DATA_CLASSIFICATION_LABELS
} from './types/classification';

const VULNERABILITY_CLASS_ICONS: Record<VulnerabilityClass, React.ComponentType<any>> = {
  Infrastructure: Server,
  Web_Application: Globe,
  Database: Database,
  Network: Wifi,
  Operating_System: HardDrive,
  Mobile_Application: Smartphone,
  Cloud_Service: Cloud,
  API: Activity,
  IoT_Device: Shield,
  Third_Party: Users
};

export default function VulnerabilityClassificationTemplates() {
  const { user } = useAuth();
  const currentTenantId = useCurrentTenantId();
  const [templates, setTemplates] = useState<ClassificationTemplate[]>([]);
  const [selectedTemplate, setSelectedTemplate] = useState<ClassificationTemplate | null>(null);
  const [showTemplateDialog, setShowTemplateDialog] = useState(false);
  const [isEditing, setIsEditing] = useState(false);
  const [metrics, setMetrics] = useState<ClassificationMetrics | null>(null);
  const [testResults, setTestResults] = useState<any[]>([]);
  const [showTestDialog, setShowTestDialog] = useState(false);
  const [loading, setLoading] = useState(true);

  // Form state for template creation/editing
  const [templateForm, setTemplateForm] = useState({
    name: '',
    description: '',
    vulnerability_class: 'Infrastructure' as VulnerabilityClass,
    enabled: true,
    priority: 1,
    criticality_criteria: {} as CriticalityCriteria,
    asset_criteria: {} as AssetCriteria,
    application_criteria: {} as ApplicationCriteria,
    actions: {
      set_priority: 'High' as 'Critical' | 'High' | 'Medium' | 'Low',
      set_sla_hours: 24,
      assign_to_team: '',
      add_tags: [] as string[],
      require_approval: false
    },
    analysis_template: '',
    recommendation_template: ''
  });

  useEffect(() => {
    if (currentTenantId) {
      loadTemplates();
      loadMetrics();
    }
  }, [currentTenantId]);

  const loadTemplates = async () => {
    if (!currentTenantId) {
      console.warn('Tenant ID não definido');
      setLoading(false);
      return;
    }

    try {
      setLoading(true);
      
      // Usar o tenant ID do contexto (funciona para usuários normais e super admin)
      const tenantId = currentTenantId;
      
      if (tenantId === 'default') {
        console.warn('Tenant ID é default:', tenantId);
        setLoading(false);
        return;
      }

      const { data: templatesData, error } = await supabase
        .from('vulnerability_classification_templates')
        .select('*')
        .eq('tenant_id', tenantId)
        .order('priority', { ascending: true });

      if (error) {
        console.error('Erro ao carregar templates:', error);
        toast.error('Erro ao carregar templates de classificação');
        return;
      }

      // Converter os dados do banco para o formato esperado
      const templates: ClassificationTemplate[] = (templatesData || []).map(template => ({
        id: template.id,
        name: template.name,
        description: template.description || '',
        vulnerability_class: template.vulnerability_class,
        enabled: template.enabled,
        priority: template.priority,
        criticality_criteria: template.criticality_criteria || {},
        asset_criteria: template.asset_criteria || {},
        application_criteria: template.application_criteria || {},
        actions: template.actions || {},
        analysis_template: template.analysis_template || '',
        recommendation_template: template.recommendation_template || '',
        created_at: new Date(template.created_at),
        updated_at: new Date(template.updated_at),
        created_by: template.created_by || user.email || 'unknown',
        last_executed: template.last_executed ? new Date(template.last_executed) : undefined,
        execution_count: template.execution_count || 0,
        success_rate: template.success_rate || 0
      }));

      setTemplates(templates);
    } catch (error) {
      console.error('Erro inesperado ao carregar templates:', error);
      toast.error('Erro inesperado ao carregar templates');
    } finally {
      setLoading(false);
    }
  };

  const loadMetrics = async () => {
    // Simulate loading metrics
    const mockMetrics: ClassificationMetrics = {
      total_templates: 8,
      active_templates: 6,
      templates_by_class: {
        Infrastructure: 2,
        Web_Application: 2,
        Database: 1,
        Network: 1,
        Operating_System: 1,
        Mobile_Application: 0,
        Cloud_Service: 1,
        API: 0,
        IoT_Device: 0,
        Third_Party: 0
      },
      total_executions: 234,
      success_rate: 94.5,
      avg_execution_time: 0.8,
      most_triggered_template: 'Vulnerabilidades Críticas de Infraestrutura',
      recent_executions: [
        {
          template_id: '1',
          template_name: 'Vulnerabilidades Críticas de Infraestrutura',
          vulnerability_count: 15,
          timestamp: new Date('2024-01-20T10:30:00'),
          success: true
        },
        {
          template_id: '2',
          template_name: 'Aplicações Web com Dados Sensíveis',
          vulnerability_count: 8,
          timestamp: new Date('2024-01-20T09:15:00'),
          success: true
        }
      ]
    };
    setMetrics(mockMetrics);
  };

  const handleCreateTemplate = () => {
    setTemplateForm({
      name: '',
      description: '',
      vulnerability_class: 'Infrastructure',
      enabled: true,
      priority: 1,
      criticality_criteria: {},
      asset_criteria: {},
      application_criteria: {},
      actions: {
        set_priority: 'High',
        set_sla_hours: 24,
        assign_to_team: '',
        add_tags: [],
        require_approval: false
      },
      analysis_template: '',
      recommendation_template: ''
    });
    setIsEditing(false);
    setShowTemplateDialog(true);
  };

  const handleEditTemplate = (template: ClassificationTemplate) => {
    setTemplateForm({
      name: template.name,
      description: template.description,
      vulnerability_class: template.vulnerability_class,
      enabled: template.enabled,
      priority: template.priority,
      criticality_criteria: template.criticality_criteria,
      asset_criteria: template.asset_criteria,
      application_criteria: template.application_criteria,
      actions: template.actions,
      analysis_template: template.analysis_template || '',
      recommendation_template: template.recommendation_template || ''
    });
    setSelectedTemplate(template);
    setIsEditing(true);
    setShowTemplateDialog(true);
  };

  const handleSaveTemplate = async () => {
    if (!templateForm.name.trim()) {
      toast.error('Nome do template é obrigatório');
      return;
    }

    if (!currentTenantId) {
      toast.error('Tenant não definido');
      return;
    }

    // Check if there's already an active template for this class
    const existingActiveTemplate = templates.find(
      t => t.vulnerability_class === templateForm.vulnerability_class && 
           t.enabled && 
           (!isEditing || t.id !== selectedTemplate?.id)
    );

    if (existingActiveTemplate && templateForm.enabled) {
      toast.error(`Já existe um template ativo para a classe ${VULNERABILITY_CLASS_LABELS[templateForm.vulnerability_class]}. Desative o template existente primeiro.`);
      return;
    }

    try {
      const tenantId = currentTenantId;
      
      if (isEditing && selectedTemplate) {
        // Update existing template
        const { error } = await supabase
          .from('vulnerability_classification_templates')
          .update({
            name: templateForm.name,
            description: templateForm.description,
            vulnerability_class: templateForm.vulnerability_class,
            enabled: templateForm.enabled,
            priority: templateForm.priority,
            criticality_criteria: templateForm.criticality_criteria,
            asset_criteria: templateForm.asset_criteria,
            application_criteria: templateForm.application_criteria,
            actions: templateForm.actions,
            analysis_template: templateForm.analysis_template,
            recommendation_template: templateForm.recommendation_template,
            updated_at: new Date().toISOString()
          })
          .eq('id', selectedTemplate.id)
          .eq('tenant_id', tenantId);

        if (error) {
          console.error('Erro ao atualizar template:', error);
          toast.error('Erro ao atualizar template');
          return;
        }

        toast.success('Template atualizado com sucesso');
      } else {
        // Create new template
        const { error } = await supabase
          .from('vulnerability_classification_templates')
          .insert({
            tenant_id: tenantId,
            name: templateForm.name,
            description: templateForm.description,
            vulnerability_class: templateForm.vulnerability_class,
            enabled: templateForm.enabled,
            priority: templateForm.priority,
            criticality_criteria: templateForm.criticality_criteria,
            asset_criteria: templateForm.asset_criteria,
            application_criteria: templateForm.application_criteria,
            actions: templateForm.actions,
            analysis_template: templateForm.analysis_template,
            recommendation_template: templateForm.recommendation_template,
            created_by: user.id
          });

        if (error) {
          console.error('Erro ao criar template:', error);
          toast.error('Erro ao criar template');
          return;
        }

        toast.success('Template criado com sucesso');
      }
      
      setShowTemplateDialog(false);
      await loadTemplates(); // Recarregar templates do banco
      await loadMetrics();
    } catch (error) {
      console.error('Erro inesperado ao salvar template:', error);
      toast.error('Erro inesperado ao salvar template');
    }
  };

  const handleDeleteTemplate = async (templateId: string) => {
    if (!confirm('Tem certeza que deseja excluir este template?')) {
      return;
    }

    if (!currentTenantId) {
      toast.error('Tenant não definido');
      return;
    }

    try {
      const { error } = await supabase
        .from('vulnerability_classification_templates')
        .delete()
        .eq('id', templateId)
        .eq('tenant_id', currentTenantId);

      if (error) {
        console.error('Erro ao excluir template:', error);
        toast.error('Erro ao excluir template');
        return;
      }

      toast.success('Template excluído com sucesso');
      await loadTemplates(); // Recarregar templates do banco
      await loadMetrics();
    } catch (error) {
      console.error('Erro inesperado ao excluir template:', error);
      toast.error('Erro inesperado ao excluir template');
    }
  };

  const handleToggleTemplate = async (templateId: string, enabled: boolean) => {
    const template = templates.find(t => t.id === templateId);
    if (!template) return;

    if (!currentTenantId) {
      toast.error('Tenant não definido');
      return;
    }

    // Check if enabling and there's already an active template for this class
    if (enabled) {
      const existingActiveTemplate = templates.find(
        t => t.vulnerability_class === template.vulnerability_class && 
             t.enabled && 
             t.id !== templateId
      );

      if (existingActiveTemplate) {
        toast.error(`Já existe um template ativo para a classe ${VULNERABILITY_CLASS_LABELS[template.vulnerability_class]}. Desative o template existente primeiro.`);
        return;
      }
    }

    try {
      const { error } = await supabase
        .from('vulnerability_classification_templates')
        .update({ 
          enabled, 
          updated_at: new Date().toISOString() 
        })
        .eq('id', templateId)
        .eq('tenant_id', currentTenantId);

      if (error) {
        console.error('Erro ao atualizar status do template:', error);
        toast.error('Erro ao atualizar status do template');
        return;
      }

      toast.success(`Template ${enabled ? 'ativado' : 'desativado'} com sucesso`);
      await loadTemplates(); // Recarregar templates do banco
    } catch (error) {
      console.error('Erro inesperado ao atualizar template:', error);
      toast.error('Erro inesperado ao atualizar template');
    }
  };

  const handleTestTemplate = async (template: ClassificationTemplate) => {
    // Simulate testing template against sample data
    const mockResults = [
      {
        vulnerability: {
          title: 'SQL Injection in Login Form',
          severity: 'Critical',
          asset_type: 'Web_Application',
          cvss_score: 9.1,
          exposure: 'Internet_Facing'
        },
        matched: true,
        criteria_met: ['CVSS Score: 9.1 >= 6.0', 'Severity: Critical', 'Asset Type: Web Application', 'Internet Facing: Yes'],
        actions_applied: ['Priority: High', 'SLA: 8 hours', 'Team: Application Security', 'Tags: web-app, pii, lgpd']
      },
      {
        vulnerability: {
          title: 'Outdated Library in Internal Tool',
          severity: 'Medium',
          asset_type: 'Web_Application',
          cvss_score: 5.2,
          exposure: 'Internal'
        },
        matched: false,
        criteria_met: ['CVSS Score: 5.2 < 6.0'],
        actions_applied: []
      }
    ];
    
    setTestResults(mockResults);
    setSelectedTemplate(template);
    setShowTestDialog(true);
  };

  const getClassIcon = (vulnerabilityClass: VulnerabilityClass) => {
    const IconComponent = VULNERABILITY_CLASS_ICONS[vulnerabilityClass];
    return <IconComponent className="h-5 w-5" />;
  };

  const getPriorityBadge = (priority: number) => {
    const colors = {
      1: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200',
      2: 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200',
      3: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200',
      4: 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200',
    };
    return (
      <Badge className={colors[priority as keyof typeof colors] || 'bg-gray-100 text-gray-800'}>
        Prioridade {priority}
      </Badge>
    );
  };

  const updateCriticalityCriteria = (updates: Partial<CriticalityCriteria>) => {
    setTemplateForm(prev => ({
      ...prev,
      criticality_criteria: { ...prev.criticality_criteria, ...updates }
    }));
  };

  const updateAssetCriteria = (updates: Partial<AssetCriteria>) => {
    setTemplateForm(prev => ({
      ...prev,
      asset_criteria: { ...prev.asset_criteria, ...updates }
    }));
  };

  const updateApplicationCriteria = (updates: Partial<ApplicationCriteria>) => {
    setTemplateForm(prev => ({
      ...prev,
      application_criteria: { ...prev.application_criteria, ...updates }
    }));
  };

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
        <div>
          <h1 className="text-3xl font-bold flex items-center gap-2">
            <Settings className="h-8 w-8 text-primary" />
            Templates de Classificação
          </h1>
          <p className="text-muted-foreground">
            Configure templates de avaliação para classificação automática de vulnerabilidades
          </p>
        </div>
        <div className="flex gap-2">
          <Button variant="outline">
            <Play className="h-4 w-4 mr-2" />
            Executar Todos
          </Button>
          <Button onClick={handleCreateTemplate}>
            <Plus className="h-4 w-4 mr-2" />
            Novo Template
          </Button>
        </div>
      </div>

      {/* Metrics Cards */}
      {metrics && (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <Card>
            <CardContent className="p-6">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm font-medium text-muted-foreground">Total de Templates</p>
                  <p className="text-2xl font-bold">{metrics.total_templates}</p>
                  <p className="text-xs text-muted-foreground">
                    {metrics.active_templates} ativos
                  </p>
                </div>
                <Settings className="h-10 w-10 text-blue-600" />
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardContent className="p-6">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm font-medium text-muted-foreground">Execuções</p>
                  <p className="text-2xl font-bold">{metrics.total_executions}</p>
                  <p className="text-xs text-muted-foreground flex items-center">
                    <TrendingUp className="h-3 w-3 mr-1 text-green-600" />
                    {metrics.success_rate}% sucesso
                  </p>
                </div>
                <Play className="h-10 w-10 text-green-600" />
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardContent className="p-6">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm font-medium text-muted-foreground">Tempo Médio</p>
                  <p className="text-2xl font-bold">{metrics.avg_execution_time}s</p>
                  <p className="text-xs text-muted-foreground">
                    Por execução
                  </p>
                </div>
                <Clock className="h-10 w-10 text-orange-600" />
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardContent className="p-6">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm font-medium text-muted-foreground">Mais Usado</p>
                  <p className="text-lg font-bold truncate">{metrics.most_triggered_template}</p>
                  <p className="text-xs text-muted-foreground">
                    Template mais executado
                  </p>
                </div>
                <Zap className="h-10 w-10 text-purple-600" />
              </div>
            </CardContent>
          </Card>
        </div>
      )}

      <Tabs defaultValue="templates" className="w-full">
        <TabsList>
          <TabsTrigger value="templates">Templates</TabsTrigger>
          <TabsTrigger value="analytics">Analytics</TabsTrigger>
          <TabsTrigger value="execution-history">Histórico</TabsTrigger>
        </TabsList>

        <TabsContent value="templates" className="space-y-6">
          {/* Loading State */}
          {loading && (
            <div className="text-center py-12">
              <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"></div>
              <p className="text-muted-foreground">Carregando templates...</p>
            </div>
          )}

          {/* Templates Grid */}
          {!loading && (
            <div className="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
              {templates.map((template) => (
              <Card key={template.id} className={`hover:shadow-lg transition-shadow ${template.enabled ? 'border-green-200 dark:border-green-800' : 'border-gray-200 dark:border-gray-700'}`}>
                <CardHeader className="pb-3">
                  <div className="flex items-start justify-between">
                    <div className="flex items-center gap-3">
                      {getClassIcon(template.vulnerability_class)}
                      <div>
                        <CardTitle className="text-lg">{template.name}</CardTitle>
                        <CardDescription className="text-sm">
                          {VULNERABILITY_CLASS_LABELS[template.vulnerability_class]}
                        </CardDescription>
                      </div>
                    </div>
                    <div className="flex items-center gap-2">
                      {getPriorityBadge(template.priority)}
                      <Badge variant={template.enabled ? 'default' : 'secondary'}>
                        {template.enabled ? 'Ativo' : 'Inativo'}
                      </Badge>
                    </div>
                  </div>
                </CardHeader>
                <CardContent className="space-y-4">
                  <p className="text-sm text-muted-foreground">{template.description}</p>
                  
                  {/* Criteria Summary */}
                  <div className="space-y-2">
                    <h4 className="text-sm font-medium">Critérios Configurados:</h4>
                    <div className="flex flex-wrap gap-1">
                      {Object.keys(template.criticality_criteria).length > 0 && (
                        <Badge variant="outline" className="text-xs">
                          <AlertTriangle className="h-3 w-3 mr-1" />
                          Criticidade
                        </Badge>
                      )}
                      {Object.keys(template.asset_criteria).length > 0 && (
                        <Badge variant="outline" className="text-xs">
                          <Shield className="h-3 w-3 mr-1" />
                          Ativo
                        </Badge>
                      )}
                      {Object.keys(template.application_criteria).length > 0 && (
                        <Badge variant="outline" className="text-xs">
                          <Target className="h-3 w-3 mr-1" />
                          Aplicação
                        </Badge>
                      )}
                    </div>
                  </div>

                  {/* Actions Summary */}
                  <div className="space-y-2">
                    <h4 className="text-sm font-medium">Ações:</h4>
                    <div className="text-xs text-muted-foreground space-y-1">
                      {template.actions.set_priority && (
                        <p>• Prioridade: {template.actions.set_priority}</p>
                      )}
                      {template.actions.set_sla_hours && (
                        <p>• SLA: {template.actions.set_sla_hours}h</p>
                      )}
                      {template.actions.assign_to_team && (
                        <p>• Equipe: {template.actions.assign_to_team}</p>
                      )}
                    </div>
                  </div>

                  {/* Stats */}
                  <div className="flex items-center justify-between text-xs text-muted-foreground pt-2 border-t">
                    <span>Executado {template.execution_count} vezes</span>
                    <span>{template.success_rate}% sucesso</span>
                  </div>

                  {/* Actions */}
                  <div className="flex items-center justify-between pt-2">
                    <Switch
                      checked={template.enabled}
                      onCheckedChange={(enabled) => handleToggleTemplate(template.id, enabled)}
                    />
                    <div className="flex gap-1">
                      <Button variant="ghost" size="sm" onClick={() => handleTestTemplate(template)}>
                        <Play className="h-4 w-4" />
                      </Button>
                      <Button variant="ghost" size="sm" onClick={() => handleEditTemplate(template)}>
                        <Edit className="h-4 w-4" />
                      </Button>
                      <Button 
                        variant="ghost" 
                        size="sm" 
                        onClick={() => handleDeleteTemplate(template.id)}
                        className="text-red-600 hover:text-red-700"
                      >
                        <Trash2 className="h-4 w-4" />
                      </Button>
                    </div>
                  </div>
                </CardContent>
              </Card>
            ))}

              {templates.length === 0 && (
                <div className="col-span-full text-center py-12">
                  <Settings className="h-12 w-12 mx-auto mb-4 opacity-50" />
                  <p className="text-muted-foreground mb-4">Nenhum template configurado</p>
                  <Button onClick={handleCreateTemplate}>
                    <Plus className="h-4 w-4 mr-2" />
                    Criar Primeiro Template
                  </Button>
                </div>
              )}
            </div>
          )}
        </TabsContent>

        <TabsContent value="analytics">
          <Card>
            <CardHeader>
              <CardTitle>Analytics de Templates</CardTitle>
              <CardDescription>
                Análise de performance e eficácia dos templates
              </CardDescription>
            </CardHeader>
            <CardContent>
              <div className="text-center py-8 text-muted-foreground">
                <BarChart3 className="h-12 w-12 mx-auto mb-4 opacity-50" />
                <p>Analytics em desenvolvimento</p>
              </div>
            </CardContent>
          </Card>
        </TabsContent>

        <TabsContent value="execution-history">
          <Card>
            <CardHeader>
              <CardTitle>Histórico de Execuções</CardTitle>
              <CardDescription>
                Histórico detalhado das execuções dos templates
              </CardDescription>
            </CardHeader>
            <CardContent>
              {metrics?.recent_executions && metrics.recent_executions.length > 0 ? (
                <Table>
                  <TableHeader>
                    <TableRow>
                      <TableHead>Template</TableHead>
                      <TableHead>Vulnerabilidades</TableHead>
                      <TableHead>Data/Hora</TableHead>
                      <TableHead>Status</TableHead>
                    </TableRow>
                  </TableHeader>
                  <TableBody>
                    {metrics.recent_executions.map((execution, index) => (
                      <TableRow key={index}>
                        <TableCell className="font-medium">{execution.template_name}</TableCell>
                        <TableCell>{execution.vulnerability_count}</TableCell>
                        <TableCell>{execution.timestamp.toLocaleString()}</TableCell>
                        <TableCell>
                          <Badge variant={execution.success ? 'default' : 'destructive'}>
                            {execution.success ? 'Sucesso' : 'Falha'}
                          </Badge>
                        </TableCell>
                      </TableRow>
                    ))}
                  </TableBody>
                </Table>
              ) : (
                <div className="text-center py-8 text-muted-foreground">
                  <Clock className="h-12 w-12 mx-auto mb-4 opacity-50" />
                  <p>Nenhuma execução registrada</p>
                </div>
              )}
            </CardContent>
          </Card>
        </TabsContent>
      </Tabs>

      {/* Template Creation/Edit Dialog */}
      <Dialog open={showTemplateDialog} onOpenChange={setShowTemplateDialog}>
        <DialogContent className="max-w-6xl max-h-[90vh] overflow-y-auto">
          <DialogHeader>
            <DialogTitle>
              {isEditing ? 'Editar Template' : 'Novo Template de Classificação'}
            </DialogTitle>
            <DialogDescription>
              Configure os critérios e ações para classificação automática de vulnerabilidades
            </DialogDescription>
          </DialogHeader>

          <div className="space-y-6">
            {/* Basic Info */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div className="space-y-2">
                <Label>Nome do Template</Label>
                <Input
                  value={templateForm.name}
                  onChange={(e) => setTemplateForm(prev => ({ ...prev, name: e.target.value }))}
                  placeholder="Ex: Vulnerabilidades Críticas de Produção"
                />
              </div>
              <div className="space-y-2">
                <Label>Classe de Vulnerabilidade</Label>
                <Select 
                  value={templateForm.vulnerability_class} 
                  onValueChange={(value) => setTemplateForm(prev => ({ ...prev, vulnerability_class: value as VulnerabilityClass }))}
                >
                  <SelectTrigger>
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    {Object.entries(VULNERABILITY_CLASS_LABELS).map(([value, label]) => (
                      <SelectItem key={value} value={value}>
                        <div className="flex items-center gap-2">
                          {getClassIcon(value as VulnerabilityClass)}
                          {label}
                        </div>
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
            </div>

            <div className="space-y-2">
              <Label>Descrição</Label>
              <Textarea
                value={templateForm.description}
                onChange={(e) => setTemplateForm(prev => ({ ...prev, description: e.target.value }))}
                placeholder="Descreva o propósito deste template..."
              />
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div className="space-y-2">
                <Label>Prioridade</Label>
                <Select 
                  value={templateForm.priority.toString()} 
                  onValueChange={(value) => setTemplateForm(prev => ({ ...prev, priority: parseInt(value) }))}
                >
                  <SelectTrigger>
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="1">1 - Crítica</SelectItem>
                    <SelectItem value="2">2 - Alta</SelectItem>
                    <SelectItem value="3">3 - Média</SelectItem>
                    <SelectItem value="4">4 - Baixa</SelectItem>
                  </SelectContent>
                </Select>
              </div>
              <div className="flex items-center space-x-2 pt-6">
                <Switch
                  checked={templateForm.enabled}
                  onCheckedChange={(enabled) => setTemplateForm(prev => ({ ...prev, enabled }))}
                />
                <Label>Template ativo</Label>
              </div>
            </div>

            {/* Criteria Tabs */}
            <Tabs defaultValue="criticality" className="w-full">
              <TabsList className="grid w-full grid-cols-3">
                <TabsTrigger value="criticality" className="flex items-center gap-2">
                  <AlertTriangle className="h-4 w-4" />
                  Criticidade
                </TabsTrigger>
                <TabsTrigger value="asset" className="flex items-center gap-2">
                  <Shield className="h-4 w-4" />
                  Ativo
                </TabsTrigger>
                <TabsTrigger value="application" className="flex items-center gap-2">
                  <Target className="h-4 w-4" />
                  Aplicação
                </TabsTrigger>
              </TabsList>

              <TabsContent value="criticality" className="space-y-4">
                <Card>
                  <CardHeader>
                    <CardTitle className="text-lg">Critérios de Criticidade</CardTitle>
                    <CardDescription>
                      Configure critérios baseados em CVSS, severidade e características da vulnerabilidade
                    </CardDescription>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Versão CVSS</Label>
                        <Select 
                          value={templateForm.criticality_criteria.cvss_version || ''} 
                          onValueChange={(value) => updateCriticalityCriteria({ cvss_version: value as CVSSVersion })}
                        >
                          <SelectTrigger>
                            <SelectValue placeholder="Selecione a versão" />
                          </SelectTrigger>
                          <SelectContent>
                            {Object.entries(CVSS_VERSION_LABELS).map(([value, label]) => (
                              <SelectItem key={value} value={value}>{label}</SelectItem>
                            ))}
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Fonte de Classificação</Label>
                        <Select 
                          value={templateForm.criticality_criteria.source_classification || ''} 
                          onValueChange={(value) => updateCriticalityCriteria({ source_classification: value as CriticalitySource })}
                        >
                          <SelectTrigger>
                            <SelectValue placeholder="Selecione a fonte" />
                          </SelectTrigger>
                          <SelectContent>
                            {Object.entries(CRITICALITY_SOURCE_LABELS).map(([value, label]) => (
                              <SelectItem key={value} value={value}>{label}</SelectItem>
                            ))}
                          </SelectContent>
                        </Select>
                      </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>CVSS Score Mínimo</Label>
                        <Input
                          type="number"
                          min="0"
                          max="10"
                          step="0.1"
                          value={templateForm.criticality_criteria.cvss_score_range?.min || ''}
                          onChange={(e) => updateCriticalityCriteria({ 
                            cvss_score_range: { 
                              ...templateForm.criticality_criteria.cvss_score_range,
                              min: parseFloat(e.target.value) || 0,
                              max: templateForm.criticality_criteria.cvss_score_range?.max || 10
                            }
                          })}
                          placeholder="0.0"
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>CVSS Score Máximo</Label>
                        <Input
                          type="number"
                          min="0"
                          max="10"
                          step="0.1"
                          value={templateForm.criticality_criteria.cvss_score_range?.max || ''}
                          onChange={(e) => updateCriticalityCriteria({ 
                            cvss_score_range: { 
                              ...templateForm.criticality_criteria.cvss_score_range,
                              min: templateForm.criticality_criteria.cvss_score_range?.min || 0,
                              max: parseFloat(e.target.value) || 10
                            }
                          })}
                          placeholder="10.0"
                        />
                      </div>
                    </div>

                    <div className="space-y-2">
                      <Label>Níveis de Severidade</Label>
                      <div className="flex flex-wrap gap-2">
                        {(['Critical', 'High', 'Medium', 'Low', 'Info'] as VulnerabilitySeverity[]).map((severity) => (
                          <div key={severity} className="flex items-center space-x-2">
                            <Checkbox
                              checked={templateForm.criticality_criteria.severity_levels?.includes(severity) || false}
                              onCheckedChange={(checked) => {
                                const current = templateForm.criticality_criteria.severity_levels || [];
                                const updated = checked 
                                  ? [...current, severity]
                                  : current.filter(s => s !== severity);
                                updateCriticalityCriteria({ severity_levels: updated });
                              }}
                            />
                            <Label className="text-sm">{severity}</Label>
                          </div>
                        ))}
                      </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      <div className="flex items-center space-x-2">
                        <Checkbox
                          checked={templateForm.criticality_criteria.exploit_available || false}
                          onCheckedChange={(checked) => updateCriticalityCriteria({ exploit_available: checked as boolean })}
                        />
                        <Label>Exploit Disponível</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <Checkbox
                          checked={templateForm.criticality_criteria.patch_available || false}
                          onCheckedChange={(checked) => updateCriticalityCriteria({ patch_available: checked as boolean })}
                        />
                        <Label>Patch Disponível</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <Checkbox
                          checked={templateForm.criticality_criteria.public_disclosure || false}
                          onCheckedChange={(checked) => updateCriticalityCriteria({ public_disclosure: checked as boolean })}
                        />
                        <Label>Divulgação Pública</Label>
                      </div>
                    </div>

                    <div className="space-y-2">
                      <Label>Idade Máxima (dias)</Label>
                      <Input
                        type="number"
                        min="0"
                        value={templateForm.criticality_criteria.age_days || ''}
                        onChange={(e) => updateCriticalityCriteria({ age_days: parseInt(e.target.value) || undefined })}
                        placeholder="Ex: 30"
                      />
                    </div>
                  </CardContent>
                </Card>
              </TabsContent>

              <TabsContent value="asset" className="space-y-4">
                <Card>
                  <CardHeader>
                    <CardTitle className="text-lg">Critérios de Ativo</CardTitle>
                    <CardDescription>
                      Configure critérios baseados no status, exposição e controles de segurança do ativo
                    </CardDescription>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="space-y-2">
                      <Label>Status do Ativo</Label>
                      <div className="flex flex-wrap gap-2">
                        {Object.entries(ASSET_STATUS_LABELS).map(([value, label]) => (
                          <div key={value} className="flex items-center space-x-2">
                            <Checkbox
                              checked={templateForm.asset_criteria.asset_status?.includes(value as AssetStatus) || false}
                              onCheckedChange={(checked) => {
                                const current = templateForm.asset_criteria.asset_status || [];
                                const updated = checked 
                                  ? [...current, value as AssetStatus]
                                  : current.filter(s => s !== value);
                                updateAssetCriteria({ asset_status: updated });
                              }}
                            />
                            <Label className="text-sm">{label}</Label>
                          </div>
                        ))}
                      </div>
                    </div>

                    <div className="space-y-2">
                      <Label>Nível de Exposição</Label>
                      <div className="flex flex-wrap gap-2">
                        {Object.entries(ASSET_EXPOSURE_LABELS).map(([value, label]) => (
                          <div key={value} className="flex items-center space-x-2">
                            <Checkbox
                              checked={templateForm.asset_criteria.exposure_level?.includes(value as AssetExposure) || false}
                              onCheckedChange={(checked) => {
                                const current = templateForm.asset_criteria.exposure_level || [];
                                const updated = checked 
                                  ? [...current, value as AssetExposure]
                                  : current.filter(s => s !== value);
                                updateAssetCriteria({ exposure_level: updated });
                              }}
                            />
                            <Label className="text-sm">{label}</Label>
                          </div>
                        ))}
                      </div>
                    </div>

                    <div className="space-y-2">
                      <Label>Controles de Segurança</Label>
                      <div className="flex flex-wrap gap-2">
                        {Object.entries(SECURITY_CONTROL_LABELS).map(([value, label]) => (
                          <div key={value} className="flex items-center space-x-2">
                            <Checkbox
                              checked={templateForm.asset_criteria.security_controls?.includes(value as SecurityControl) || false}
                              onCheckedChange={(checked) => {
                                const current = templateForm.asset_criteria.security_controls || [];
                                const updated = checked 
                                  ? [...current, value as SecurityControl]
                                  : current.filter(s => s !== value);
                                updateAssetCriteria({ security_controls: updated });
                              }}
                            />
                            <Label className="text-sm">{label}</Label>
                          </div>
                        ))}
                      </div>
                    </div>

                    <div className="space-y-2">
                      <Label>Tipos de Ativo</Label>
                      <div className="flex flex-wrap gap-2">
                        {(['Web_Application', 'Mobile_App', 'API', 'Database', 'Server', 'Network_Device', 'Cloud_Service', 'Desktop_App'] as AssetType[]).map((type) => (
                          <div key={type} className="flex items-center space-x-2">
                            <Checkbox
                              checked={templateForm.asset_criteria.asset_types?.includes(type) || false}
                              onCheckedChange={(checked) => {
                                const current = templateForm.asset_criteria.asset_types || [];
                                const updated = checked 
                                  ? [...current, type]
                                  : current.filter(s => s !== type);
                                updateAssetCriteria({ asset_types: updated });
                              }}
                            />
                            <Label className="text-sm">{type.replace('_', ' ')}</Label>
                          </div>
                        ))}
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </TabsContent>

              <TabsContent value="application" className="space-y-4">
                <Card>
                  <CardHeader>
                    <CardTitle className="text-lg">Critérios de Aplicação</CardTitle>
                    <CardDescription>
                      Configure critérios baseados na criticidade do negócio e requisitos de compliance
                    </CardDescription>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="space-y-2">
                      <Label>Criticidade do Negócio</Label>
                      <div className="flex flex-wrap gap-2">
                        {Object.entries(BUSINESS_CRITICALITY_LABELS).map(([value, label]) => (
                          <div key={value} className="flex items-center space-x-2">
                            <Checkbox
                              checked={templateForm.application_criteria.business_criticality?.includes(value as BusinessCriticality) || false}
                              onCheckedChange={(checked) => {
                                const current = templateForm.application_criteria.business_criticality || [];
                                const updated = checked 
                                  ? [...current, value as BusinessCriticality]
                                  : current.filter(s => s !== value);
                                updateApplicationCriteria({ business_criticality: updated });
                              }}
                            />
                            <Label className="text-sm">{label}</Label>
                          </div>
                        ))}
                      </div>
                    </div>

                    <div className="space-y-2">
                      <Label>Frameworks de Compliance</Label>
                      <div className="flex flex-wrap gap-2">
                        {Object.entries(COMPLIANCE_FRAMEWORK_LABELS).map(([value, label]) => (
                          <div key={value} className="flex items-center space-x-2">
                            <Checkbox
                              checked={templateForm.application_criteria.compliance_frameworks?.includes(value as ComplianceFramework) || false}
                              onCheckedChange={(checked) => {
                                const current = templateForm.application_criteria.compliance_frameworks || [];
                                const updated = checked 
                                  ? [...current, value as ComplianceFramework]
                                  : current.filter(s => s !== value);
                                updateApplicationCriteria({ compliance_frameworks: updated });
                              }}
                            />
                            <Label className="text-sm">{label}</Label>
                          </div>
                        ))}
                      </div>
                    </div>

                    <div className="space-y-2">
                      <Label>Classificação de Dados</Label>
                      <div className="flex flex-wrap gap-2">
                        {Object.entries(DATA_CLASSIFICATION_LABELS).map(([value, label]) => (
                          <div key={value} className="flex items-center space-x-2">
                            <Checkbox
                              checked={templateForm.application_criteria.data_classification?.includes(value as DataClassification) || false}
                              onCheckedChange={(checked) => {
                                const current = templateForm.application_criteria.data_classification || [];
                                const updated = checked 
                                  ? [...current, value as DataClassification]
                                  : current.filter(s => s !== value);
                                updateApplicationCriteria({ data_classification: updated });
                              }}
                            />
                            <Label className="text-sm">{label}</Label>
                          </div>
                        ))}
                      </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Tamanho da Base de Usuários</Label>
                        <Select 
                          value={templateForm.application_criteria.user_base_size || ''} 
                          onValueChange={(value) => updateApplicationCriteria({ user_base_size: value as any })}
                        >
                          <SelectTrigger>
                            <SelectValue placeholder="Selecione o tamanho" />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="Small">Pequeno (&lt; 100)</SelectItem>
                            <SelectItem value="Medium">Médio (100-1000)</SelectItem>
                            <SelectItem value="Large">Grande (1000-10000)</SelectItem>
                            <SelectItem value="Enterprise">Enterprise (&gt; 10000)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Impacto na Receita</Label>
                        <Select 
                          value={templateForm.application_criteria.revenue_impact || ''} 
                          onValueChange={(value) => updateApplicationCriteria({ revenue_impact: value as any })}
                        >
                          <SelectTrigger>
                            <SelectValue placeholder="Selecione o impacto" />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="None">Nenhum</SelectItem>
                            <SelectItem value="Low">Baixo</SelectItem>
                            <SelectItem value="Medium">Médio</SelectItem>
                            <SelectItem value="High">Alto</SelectItem>
                            <SelectItem value="Critical">Crítico</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      <div className="flex items-center space-x-2">
                        <Checkbox
                          checked={templateForm.application_criteria.customer_facing || false}
                          onCheckedChange={(checked) => updateApplicationCriteria({ customer_facing: checked as boolean })}
                        />
                        <Label>Voltado ao Cliente</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <Checkbox
                          checked={templateForm.application_criteria.processes_pii || false}
                          onCheckedChange={(checked) => updateApplicationCriteria({ processes_pii: checked as boolean })}
                        />
                        <Label>Processa PII</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <Checkbox
                          checked={templateForm.application_criteria.processes_financial_data || false}
                          onCheckedChange={(checked) => updateApplicationCriteria({ processes_financial_data: checked as boolean })}
                        />
                        <Label>Dados Financeiros</Label>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </TabsContent>
            </Tabs>

            {/* Actions Configuration */}
            <Card>
              <CardHeader>
                <CardTitle className="text-lg">Ações e Recomendações</CardTitle>
                <CardDescription>
                  Configure as ações que serão executadas quando os critérios forem atendidos
                </CardDescription>
              </CardHeader>
              <CardContent className="space-y-4">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div className="space-y-2">
                    <Label>Definir Prioridade</Label>
                    <Select 
                      value={templateForm.actions.set_priority || ''} 
                      onValueChange={(value) => setTemplateForm(prev => ({ 
                        ...prev, 
                        actions: { ...prev.actions, set_priority: value as any }
                      }))}
                    >
                      <SelectTrigger>
                        <SelectValue placeholder="Selecione a prioridade" />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="Critical">Crítica</SelectItem>
                        <SelectItem value="High">Alta</SelectItem>
                        <SelectItem value="Medium">Média</SelectItem>
                        <SelectItem value="Low">Baixa</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div className="space-y-2">
                    <Label>SLA (horas)</Label>
                    <Input
                      type="number"
                      min="1"
                      value={templateForm.actions.set_sla_hours || ''}
                      onChange={(e) => setTemplateForm(prev => ({ 
                        ...prev, 
                        actions: { ...prev.actions, set_sla_hours: parseInt(e.target.value) || undefined }
                      }))}
                      placeholder="Ex: 24"
                    />
                  </div>
                </div>

                <div className="space-y-2">
                  <Label>Atribuir à Equipe</Label>
                  <Input
                    value={templateForm.actions.assign_to_team || ''}
                    onChange={(e) => setTemplateForm(prev => ({ 
                      ...prev, 
                      actions: { ...prev.actions, assign_to_team: e.target.value }
                    }))}
                    placeholder="Ex: Security Team"
                  />
                </div>

                <div className="flex items-center space-x-2">
                  <Checkbox
                    checked={templateForm.actions.require_approval || false}
                    onCheckedChange={(checked) => setTemplateForm(prev => ({ 
                      ...prev, 
                      actions: { ...prev.actions, require_approval: checked as boolean }
                    }))}
                  />
                  <Label>Requer Aprovação</Label>
                </div>

                <div className="space-y-2">
                  <Label>Template de Análise</Label>
                  <Textarea
                    value={templateForm.analysis_template}
                    onChange={(e) => setTemplateForm(prev => ({ ...prev, analysis_template: e.target.value }))}
                    placeholder="Template para análise automática da vulnerabilidade..."
                    rows={3}
                  />
                </div>

                <div className="space-y-2">
                  <Label>Template de Recomendação</Label>
                  <Textarea
                    value={templateForm.recommendation_template}
                    onChange={(e) => setTemplateForm(prev => ({ ...prev, recommendation_template: e.target.value }))}
                    placeholder="Template para recomendações de remediação..."
                    rows={3}
                  />
                </div>
              </CardContent>
            </Card>
          </div>

          <DialogFooter>
            <Button variant="outline" onClick={() => setShowTemplateDialog(false)}>
              Cancelar
            </Button>
            <Button onClick={handleSaveTemplate}>
              {isEditing ? 'Atualizar' : 'Criar'} Template
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      {/* Test Results Dialog */}
      <Dialog open={showTestDialog} onOpenChange={setShowTestDialog}>
        <DialogContent className="max-w-4xl">
          <DialogHeader>
            <DialogTitle>Resultado do Teste</DialogTitle>
            <DialogDescription>
              Resultado da execução do template "{selectedTemplate?.name}" contra dados de exemplo
            </DialogDescription>
          </DialogHeader>

          <div className="space-y-4">
            {testResults.map((result, index) => (
              <Card key={index}>
                <CardContent className="p-4">
                  <div className="flex items-center justify-between mb-3">
                    <h4 className="font-medium">{result.vulnerability.title}</h4>
                    <Badge className={result.matched ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}>
                      {result.matched ? 'Corresponde' : 'Não corresponde'}
                    </Badge>
                  </div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <div>
                      <p className="font-medium mb-2">Detalhes da Vulnerabilidade:</p>
                      <div className="space-y-1 text-muted-foreground">
                        <p>Severidade: {result.vulnerability.severity}</p>
                        <p>Tipo de Ativo: {result.vulnerability.asset_type}</p>
                        <p>CVSS Score: {result.vulnerability.cvss_score}</p>
                        <p>Exposição: {result.vulnerability.exposure}</p>
                      </div>
                    </div>
                    
                    <div>
                      <p className="font-medium mb-2">Critérios Avaliados:</p>
                      <div className="space-y-1">
                        {result.criteria_met.map((criteria: string, criteriaIndex: number) => (
                          <p key={criteriaIndex} className={`text-sm ${result.matched ? 'text-green-600' : 'text-red-600'}`}>
                            • {criteria}
                          </p>
                        ))}
                      </div>
                    </div>
                  </div>

                  {result.matched && result.actions_applied.length > 0 && (
                    <div className="mt-4 pt-4 border-t">
                      <p className="font-medium mb-2">Ações Aplicadas:</p>
                      <div className="space-y-1">
                        {result.actions_applied.map((action: string, actionIndex: number) => (
                          <p key={actionIndex} className="text-sm text-green-600">• {action}</p>
                        ))}
                      </div>
                    </div>
                  )}
                </CardContent>
              </Card>
            ))}
          </div>

          <DialogFooter>
            <Button onClick={() => setShowTestDialog(false)}>Fechar</Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </div>
  );
}