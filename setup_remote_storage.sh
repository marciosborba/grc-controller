#!/bin/bash\n\necho \"=== 🔧 CONFIGURAÇÃO DO STORAGE NO SUPABASE REMOTO ===\"\necho \"⏰ Timestamp: $(date -Iseconds)\"\necho \"\"\n\n# Configurações do Supabase remoto\nSUPABASE_URL=\"https://myxvxponlmulnjstbjwd.supabase.co\"\nANON_KEY=\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im15eHZ4cG9ubG11bG5qc3RiandkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwMTQzNTMsImV4cCI6MjA2ODU5MDM1M30.V9yqc2cgrRCLxlXF2HkISzPT9WQ7Hw14r_yE8UROgD4\"\nSERVICE_KEY=\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im15eHZ4cG9ubG11bG5qc3RiandkIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MzAxNDM1MywiZXhwIjoyMDY4NTkwMzUzfQ.Ej8Ej8Ej8Ej8Ej8Ej8Ej8Ej8Ej8Ej8Ej8Ej8Ej8Ej8\"\n\necho \"🌐 ETAPA 1: Verificando conectividade com Supabase remoto...\"\ncurl -s -o /dev/null -w \"Status: %{http_code}, Tempo: %{time_total}s\\n\" \"$SUPABASE_URL/rest/v1/\" \\\n  -H \"apikey: $ANON_KEY\"\n\necho \"\"\necho \"📦 ETAPA 2: Verificando buckets existentes...\"\necho \"Listando buckets com token anônimo:\"\ncurl -s \"$SUPABASE_URL/storage/v1/bucket\" \\\n  -H \"Authorization: Bearer $ANON_KEY\" \\\n  | jq '.' 2>/dev/null || echo \"Erro ao listar buckets ou jq não instalado\"\n\necho \"\"\necho \"Listando buckets com service role:\"\ncurl -s \"$SUPABASE_URL/storage/v1/bucket\" \\\n  -H \"Authorization: Bearer $SERVICE_KEY\" \\\n  | jq '.' 2>/dev/null || echo \"Erro ao listar buckets ou jq não instalado\"\n\necho \"\"\necho \"🚀 ETAPA 3: Criando bucket policy-documents (se não existir)...\"\necho \"Tentando criar bucket:\"\ncurl -X POST \"$SUPABASE_URL/storage/v1/bucket\" \\\n  -H \"Authorization: Bearer $SERVICE_KEY\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"id\": \"policy-documents\", \"name\": \"policy-documents\", \"public\": true}' \\\n  2>/dev/null || echo \"Bucket pode já existir\"\n\necho \"\"\necho \"📋 ETAPA 4: Verificando se bucket foi criado...\"\ncurl -s \"$SUPABASE_URL/storage/v1/bucket\" \\\n  -H \"Authorization: Bearer $SERVICE_KEY\" \\\n  | jq '.[] | select(.name == \"policy-documents\")' 2>/dev/null || echo \"Verificação manual necessária\"\n\necho \"\"\necho \"🧪 ETAPA 5: Testando upload...\"\necho \"Testando upload com token anônimo:\"\necho \"Conteúdo de teste para Supabase remoto - $(date)\" > /tmp/test-remote-upload.txt\ncurl -X POST \"$SUPABASE_URL/storage/v1/object/policy-documents/test-remote-$(date +%s).txt\" \\\n  -H \"Authorization: Bearer $ANON_KEY\" \\\n  -H \"Content-Type: text/plain\" \\\n  --data-binary @/tmp/test-remote-upload.txt\n\necho \"\"\necho \"\"\necho \"=== 📋 RESUMO ===\"\necho \"✅ Supabase remoto: $SUPABASE_URL\"\necho \"✅ Token anônimo: ${ANON_KEY:0:20}...\"\necho \"✅ Service role: ${SERVICE_KEY:0:20}...\"\necho \"\"\necho \"🎯 Próximos passos:\"\necho \"1. Verificar se o bucket 'policy-documents' foi criado\"\necho \"2. Configurar políticas RLS no dashboard do Supabase\"\necho \"3. Testar upload via interface da aplicação\"\necho \"\"\necho \"🔗 Dashboard: https://supabase.com/dashboard/project/myxvxponlmulnjstbjwd\"\necho \"📁 Storage: https://supabase.com/dashboard/project/myxvxponlmulnjstbjwd/storage/buckets\"\necho \"🔐 Auth: https://supabase.com/dashboard/project/myxvxponlmulnjstbjwd/auth/users\"\n